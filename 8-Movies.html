<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>第 8 章 电影 | Kaggle数据项目实战</title>
  <meta name="description" content="最初看到 elegantbook 做的书籍样式很漂亮，就想把它引入到 bookdown 中，遂定制了此模版。在此基础上，做了迁移和扩展的工作，融合了 LaTeX (精美)、Pandoc (简洁) 和 R (强大) 的特性。This is a bookdown template based on ElegantBook. The output format for this template is bookdown::gitbook and bookdown::pdf_book." />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="第 8 章 电影 | Kaggle数据项目实战" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="最初看到 elegantbook 做的书籍样式很漂亮，就想把它引入到 bookdown 中，遂定制了此模版。在此基础上，做了迁移和扩展的工作，融合了 LaTeX (精美)、Pandoc (简洁) 和 R (强大) 的特性。This is a bookdown template based on ElegantBook. The output format for this template is bookdown::gitbook and bookdown::pdf_book." />
  <meta name="github-repo" content="XiangyunHuang/ElegantBookdown" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="第 8 章 电影 | Kaggle数据项目实战" />
  
  <meta name="twitter:description" content="最初看到 elegantbook 做的书籍样式很漂亮，就想把它引入到 bookdown 中，遂定制了此模版。在此基础上，做了迁移和扩展的工作，融合了 LaTeX (精美)、Pandoc (简洁) 和 R (强大) 的特性。This is a bookdown template based on ElegantBook. The output format for this template is bookdown::gitbook and bookdown::pdf_book." />
  

<meta name="author" content="Lee" />


<meta name="date" content="2022-04-20" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="7-mushrooms.html"/>
<link rel="next" href="23-appendix.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.10.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      TeX: {
        Macros: {
          bm: ["{\\boldsymbol #1}",1],
        },
        extensions: ["cancel.js"]
      }
    });
</script>

<!-- add line break after theorem title -->
<script>
  document.addEventListener("DOMContentLoaded", (event) => {
    for (let s of document.querySelectorAll("span.theorem, span.lemma, span.proposition, span.corollary")) {
      s.insertAdjacentHTML('afterend', '<br style="line-height:2px;"/>');
    }
  });
</script>

<!-- check if --themcolor in style.css matches one of elegantbook theme colors. If so, generates the color palette  -->
<script>
  document.addEventListener("DOMContentLoaded", (event) => {
    const cssroot = document.querySelector(':root');
    let theme_color = getComputedStyle(document.documentElement).getPropertyValue('--themecolor').trim();
  
    // blue is the default option

    switch (theme_color) {
      case 'green': 
        cssroot.style.setProperty('--structurecolor', 'rgb(0,120,2)');
        cssroot.style.setProperty('--main', 'rgb(70,70,70)');
        cssroot.style.setProperty('--mainbg', 'rgba(0,166,82,0.05)');
        cssroot.style.setProperty('--second', 'rgb(115,45,2)');
        cssroot.style.setProperty('--secondbg', 'rgba(115,45,2,0.05)');
        cssroot.style.setProperty('--third', 'rgb(0,80,80)');
        cssroot.style.setProperty('--thirdbg', 'rgba(0,80,80,0.05)');
      break;
      case 'cyan':
        cssroot.style.setProperty('--structurecolor', 'rgb(31,186,190)');
        cssroot.style.setProperty('--main', 'rgb(59,180,5)');
        cssroot.style.setProperty('--mainbg', 'rgba(59,180,5,0.05)');
        cssroot.style.setProperty('--second', 'rgb(175,153,8)');
        cssroot.style.setProperty('--secondbg', 'rgba(175,153,8,0.05)');
        cssroot.style.setProperty('--third', 'rgb(244,105,102)');
        cssroot.style.setProperty('--thirdbg', 'rgba(244,105,102,0.05)');
      break;
      case 'gray':
        cssroot.style.setProperty('--structurecolor', 'rgb(150,150,150)');
        cssroot.style.setProperty('--main', 'rgb(150,150,150)');
        cssroot.style.setProperty('--mainbg', 'rgba(150,150,150,0.05)');
        cssroot.style.setProperty('--second', 'rgb(150,150,150)');
        cssroot.style.setProperty('--secondbg', 'rgba(150,150,150,0.05)');
        cssroot.style.setProperty('--third', 'rgb(150,150,150)');
        cssroot.style.setProperty('--thirdbg', 'rgba(150,150,150,0.05)');
      break;
      case 'black':
        cssroot.style.setProperty('--structurecolor', 'rgb(0,0,0)');
        cssroot.style.setProperty('--main', 'rgb(0,0,0)');
        cssroot.style.setProperty('--mainbg', 'rgba(0,0,0,0.05)');
        cssroot.style.setProperty('--second', 'rgb(0,0,0)');
        cssroot.style.setProperty('--secondbg', 'rgba(0,0,0,0.05)');
        cssroot.style.setProperty('--third', 'rgb(0,0,0)');
        cssroot.style.setProperty('--thirdbg', 'rgba(0,0,0,0.05)');
      break;
    default:
        cssroot.style.setProperty('--structurecolor', 'rgb(60,113,183)');
        cssroot.style.setProperty('--main', 'rgb(0,166,82)');
        cssroot.style.setProperty('--mainbg', 'rgba(0,166,82,0.05)');
        cssroot.style.setProperty('--second', 'rgb(255,134,24)');
        cssroot.style.setProperty('--secondbg', 'rgba(255,134,24,0.05)');
        cssroot.style.setProperty('--third', 'rgb(0,174,247)');
        cssroot.style.setProperty('--thirdbg', 'rgba(0,174,247,0.05)');
    }
  });
  </script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Elegant Bookdown Template</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>简介</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#theorem-block"><i class="fa fa-check"></i><b>0.1</b> 已有 Block</a></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#math-formular"><i class="fa fa-check"></i><b>0.2</b> 数学公式</a></li>
<li class="chapter" data-level="0.3" data-path="index.html"><a href="index.html#custom-block"><i class="fa fa-check"></i><b>0.3</b> 自定义 block</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="1-vgsales.html"><a href="1-vgsales.html"><i class="fa fa-check"></i><b>1</b> Video Games Sales</a>
<ul>
<li class="chapter" data-level="1.1" data-path="1-vgsales.html"><a href="1-vgsales.html#game-sales-intro"><i class="fa fa-check"></i><b>1.1</b> 准备</a></li>
<li class="chapter" data-level="1.2" data-path="1-vgsales.html"><a href="1-vgsales.html#缺失值处理"><i class="fa fa-check"></i><b>1.2</b> 缺失值处理</a></li>
<li class="chapter" data-level="1.3" data-path="1-vgsales.html"><a href="1-vgsales.html#描述性分析"><i class="fa fa-check"></i><b>1.3</b> 描述性分析</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="1-vgsales.html"><a href="1-vgsales.html#常规分析"><i class="fa fa-check"></i><b>1.3.1</b> 常规分析</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="1-vgsales.html"><a href="1-vgsales.html#探索性分析"><i class="fa fa-check"></i><b>1.4</b> 探索性分析</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="1-vgsales.html"><a href="1-vgsales.html#世界最畅销游戏"><i class="fa fa-check"></i><b>1.4.1</b> 世界最畅销游戏</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="1-vgsales.html"><a href="1-vgsales.html#媒体打分与玩家打分的关系"><i class="fa fa-check"></i><b>1.5</b> 媒体打分与玩家打分的关系</a></li>
<li class="chapter" data-level="1.6" data-path="1-vgsales.html"><a href="1-vgsales.html#玩家与媒体分别最喜欢哪个发行商"><i class="fa fa-check"></i><b>1.6</b> 玩家与媒体分别最喜欢哪个发行商</a>
<ul>
<li class="chapter" data-level="1.6.1" data-path="1-vgsales.html"><a href="1-vgsales.html#玩家"><i class="fa fa-check"></i><b>1.6.1</b> 玩家</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="2-Olympic-history.html"><a href="2-Olympic-history.html"><i class="fa fa-check"></i><b>2</b> Olympic history</a>
<ul>
<li class="chapter" data-level="2.1" data-path="2-Olympic-history.html"><a href="2-Olympic-history.html#olympic-intro"><i class="fa fa-check"></i><b>2.1</b> 介绍</a></li>
<li class="chapter" data-level="2.2" data-path="2-Olympic-history.html"><a href="2-Olympic-history.html#运动员国家和时间"><i class="fa fa-check"></i><b>2.2</b> 运动员、国家和时间</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="2-Olympic-history.html"><a href="2-Olympic-history.html#随着时间的推移运动员国家和赛事的数量是否发生了变化"><i class="fa fa-check"></i><b>2.2.1</b> 随着时间的推移，运动员、国家和赛事的数量是否发生了变化？</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="2-Olympic-history.html"><a href="2-Olympic-history.html#sec:art-com"><i class="fa fa-check"></i><b>2.3</b> 艺术竞赛（The Art Competitions）</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="2-Olympic-history.html"><a href="2-Olympic-history.html#运动员时间参赛项目"><i class="fa fa-check"></i><b>2.3.1</b> 运动员、时间、参赛项目</a></li>
<li class="chapter" data-level="2.3.2" data-path="2-Olympic-history.html"><a href="2-Olympic-history.html#获得奖牌情况-哪个国家获得的艺术竞赛类奖牌数量最多"><i class="fa fa-check"></i><b>2.3.2</b> 获得奖牌情况-哪个国家获得的艺术竞赛类奖牌数量最多</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="2-Olympic-history.html"><a href="2-Olympic-history.html#奥林匹克中的女将们"><i class="fa fa-check"></i><b>2.4</b> 奥林匹克中的女将们</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="2-Olympic-history.html"><a href="2-Olympic-history.html#男女运动员数量比较"><i class="fa fa-check"></i><b>2.4.1</b> 男女运动员数量比较</a></li>
<li class="chapter" data-level="2.4.2" data-path="2-Olympic-history.html"><a href="2-Olympic-history.html#各国参赛男女运动员间数量关系"><i class="fa fa-check"></i><b>2.4.2</b> 各国参赛男女运动员间数量关系</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="2-Olympic-history.html"><a href="2-Olympic-history.html#奖牌榜medal-count"><i class="fa fa-check"></i><b>2.5</b> 奖牌榜（Medal Count）</a></li>
<li class="chapter" data-level="2.6" data-path="2-Olympic-history.html"><a href="2-Olympic-history.html#地理信息地图"><i class="fa fa-check"></i><b>2.6</b> 地理信息地图</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="2-Olympic-history.html"><a href="2-Olympic-history.html#年奥运会情况"><i class="fa fa-check"></i><b>2.6.1</b> 1928年奥运会情况</a></li>
<li class="chapter" data-level="2.6.2" data-path="2-Olympic-history.html"><a href="2-Olympic-history.html#年奥运会情况-1"><i class="fa fa-check"></i><b>2.6.2</b> 1972年奥运会情况</a></li>
<li class="chapter" data-level="2.6.3" data-path="2-Olympic-history.html"><a href="2-Olympic-history.html#年奥运会情况-2"><i class="fa fa-check"></i><b>2.6.3</b> 2016年奥运会情况</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="2-Olympic-history.html"><a href="2-Olympic-history.html#参赛运动员身高体重"><i class="fa fa-check"></i><b>2.7</b> 参赛运动员身高体重</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="2-Olympic-history.html"><a href="2-Olympic-history.html#数据完整性及可用性检测"><i class="fa fa-check"></i><b>2.7.1</b> 数据完整性及可用性检测</a></li>
<li class="chapter" data-level="2.7.2" data-path="2-Olympic-history.html"><a href="2-Olympic-history.html#身高体重"><i class="fa fa-check"></i><b>2.7.2</b> 身高体重</a></li>
<li class="chapter" data-level="2.7.3" data-path="2-Olympic-history.html"><a href="2-Olympic-history.html#change-in-weight-vs-change-in-height-over-times-across-mens-sports"><i class="fa fa-check"></i><b>2.7.3</b> change in Weight VS change in Height over times across men’s sports</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="3-HR-comma-sep.html"><a href="3-HR-comma-sep.html"><i class="fa fa-check"></i><b>3</b> 员工离职分析</a>
<ul>
<li class="chapter" data-level="3.1" data-path="3-HR-comma-sep.html"><a href="3-HR-comma-sep.html#sec:first2"><i class="fa fa-check"></i><b>3.1</b> 描述性分析</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="3-HR-comma-sep.html"><a href="3-HR-comma-sep.html#sec:first21"><i class="fa fa-check"></i><b>3.1.1</b> 数据概览</a></li>
<li class="chapter" data-level="3.1.2" data-path="3-HR-comma-sep.html"><a href="3-HR-comma-sep.html#sec:first22"><i class="fa fa-check"></i><b>3.1.2</b> 员工离职情况与员工满意度、月均工作时间、绩效评估和在职年限的关系</a></li>
<li class="chapter" data-level="3.1.3" data-path="3-HR-comma-sep.html"><a href="3-HR-comma-sep.html#sec:first23"><i class="fa fa-check"></i><b>3.1.3</b> 员工离职情况与项目参与个数、五年内升职情况和薪资的关系</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="3-HR-comma-sep.html"><a href="3-HR-comma-sep.html#sec:three-model1"><i class="fa fa-check"></i><b>3.2</b> 建模预测1-回归树+混淆矩阵</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="3-HR-comma-sep.html"><a href="3-HR-comma-sep.html#提取数据"><i class="fa fa-check"></i><b>3.2.1</b> 提取数据</a></li>
<li class="chapter" data-level="3.2.2" data-path="3-HR-comma-sep.html"><a href="3-HR-comma-sep.html#确定交叉验证方法"><i class="fa fa-check"></i><b>3.2.2</b> 确定交叉验证方法</a></li>
<li class="chapter" data-level="3.2.3" data-path="3-HR-comma-sep.html"><a href="3-HR-comma-sep.html#分层抽样-分层抽样"><i class="fa fa-check"></i><b>3.2.3</b> 分层抽样 </a></li>
<li class="chapter" data-level="3.2.4" data-path="3-HR-comma-sep.html"><a href="3-HR-comma-sep.html#实际建模"><i class="fa fa-check"></i><b>3.2.4</b> 实际建模</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="3-HR-comma-sep.html"><a href="3-HR-comma-sep.html#sec:three-model2"><i class="fa fa-check"></i><b>3.3</b> 建模预测2-朴素贝叶斯</a></li>
<li class="chapter" data-level="3.4" data-path="3-HR-comma-sep.html"><a href="3-HR-comma-sep.html#sec:three-model-use"><i class="fa fa-check"></i><b>3.4</b> 模型评估及应用</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="3-HR-comma-sep.html"><a href="3-HR-comma-sep.html#roc曲线绘制"><i class="fa fa-check"></i><b>3.4.1</b> <code>ROC</code>曲线绘制</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="3-HR-comma-sep.html"><a href="3-HR-comma-sep.html#模型应用"><i class="fa fa-check"></i><b>3.5</b> 模型应用</a></li>
<li class="chapter" data-level="3.6" data-path="3-HR-comma-sep.html"><a href="3-HR-comma-sep.html#mlr3建模"><i class="fa fa-check"></i><b>3.6</b> mlr3建模</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="3-HR-comma-sep.html"><a href="3-HR-comma-sep.html#回归树模型"><i class="fa fa-check"></i><b>3.6.1</b> 回归树模型</a></li>
<li class="chapter" data-level="3.6.2" data-path="3-HR-comma-sep.html"><a href="3-HR-comma-sep.html#朴素贝叶斯模型"><i class="fa fa-check"></i><b>3.6.2</b> 朴素贝叶斯模型</a></li>
<li class="chapter" data-level="3.6.3" data-path="3-HR-comma-sep.html"><a href="3-HR-comma-sep.html#利用mlr3进行roc曲线绘制"><i class="fa fa-check"></i><b>3.6.3</b> 利用mlr3进行ROC曲线绘制</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="4-creditcard.html"><a href="4-creditcard.html"><i class="fa fa-check"></i><b>4</b> 信用卡欺诈识别</a>
<ul>
<li class="chapter" data-level="4.1" data-path="4-creditcard.html"><a href="4-creditcard.html#sec:five1"><i class="fa fa-check"></i><b>4.1</b> 数据变量说明</a></li>
<li class="chapter" data-level="4.2" data-path="4-creditcard.html"><a href="4-creditcard.html#sec:five2"><i class="fa fa-check"></i><b>4.2</b> 数据预处理</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="4-creditcard.html"><a href="4-creditcard.html#sec:five22"><i class="fa fa-check"></i><b>4.2.1</b> 分层抽样</a></li>
<li class="chapter" data-level="4.2.2" data-path="4-creditcard.html"><a href="4-creditcard.html#sec:five23"><i class="fa fa-check"></i><b>4.2.2</b> 标准化</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="4-creditcard.html"><a href="4-creditcard.html#sec:five3"><i class="fa fa-check"></i><b>4.3</b> 描述性分析</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="4-creditcard.html"><a href="4-creditcard.html#不同时间诈骗次数-条形图"><i class="fa fa-check"></i><b>4.3.1</b> 不同时间诈骗次数-条形图</a></li>
<li class="chapter" data-level="4.3.2" data-path="4-creditcard.html"><a href="4-creditcard.html#不同时间诈骗金额-箱线图"><i class="fa fa-check"></i><b>4.3.2</b> 不同时间诈骗金额-箱线图</a></li>
<li class="chapter" data-level="4.3.3" data-path="4-creditcard.html"><a href="4-creditcard.html#不同时间平均诈骗金额-条形图"><i class="fa fa-check"></i><b>4.3.3</b> 不同时间平均诈骗金额-条形图</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="4-creditcard.html"><a href="4-creditcard.html#sec:five4"><i class="fa fa-check"></i><b>4.4</b> 自动参数调整调参-使用<code>caret</code>包</a></li>
<li class="chapter" data-level="4.5" data-path="4-creditcard.html"><a href="4-creditcard.html#sec:five5"><i class="fa fa-check"></i><b>4.5</b> kNN建模</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="4-creditcard.html"><a href="4-creditcard.html#原理"><i class="fa fa-check"></i><b>4.5.1</b> 原理</a></li>
<li class="chapter" data-level="4.5.2" data-path="4-creditcard.html"><a href="4-creditcard.html#模型建立"><i class="fa fa-check"></i><b>4.5.2</b> 模型建立</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="4-creditcard.html"><a href="4-creditcard.html#sec:five6"><i class="fa fa-check"></i><b>4.6</b> 模型评估</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="5-Student-performance-level.html"><a href="5-Student-performance-level.html"><i class="fa fa-check"></i><b>5</b> 学生成绩水平分类</a>
<ul>
<li class="chapter" data-level="5.1" data-path="5-Student-performance-level.html"><a href="5-Student-performance-level.html#sec:data-intro-edu"><i class="fa fa-check"></i><b>5.1</b> 数据变量说明</a></li>
<li class="chapter" data-level="5.2" data-path="5-Student-performance-level.html"><a href="5-Student-performance-level.html#sec:descriptive-analysis"><i class="fa fa-check"></i><b>5.2</b> 描述性分析</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="5-Student-performance-level.html"><a href="5-Student-performance-level.html#封装绘图函数"><i class="fa fa-check"></i><b>5.2.1</b> 封装绘图函数</a></li>
<li class="chapter" data-level="5.2.2" data-path="5-Student-performance-level.html"><a href="5-Student-performance-level.html#不同教育程度的学生选择课程主题"><i class="fa fa-check"></i><b>5.2.2</b> 不同教育程度的学生选择课程主题</a></li>
<li class="chapter" data-level="5.2.3" data-path="5-Student-performance-level.html"><a href="5-Student-performance-level.html#不同课程主题监护人情况"><i class="fa fa-check"></i><b>5.2.3</b> 不同课程主题监护人情况</a></li>
<li class="chapter" data-level="5.2.4" data-path="5-Student-performance-level.html"><a href="5-Student-performance-level.html#不同课程学生学习成绩"><i class="fa fa-check"></i><b>5.2.4</b> 不同课程学生学习成绩</a></li>
<li class="chapter" data-level="5.2.5" data-path="5-Student-performance-level.html"><a href="5-Student-performance-level.html#不同教室学生成绩水平"><i class="fa fa-check"></i><b>5.2.5</b> 不同教室学生成绩水平</a></li>
<li class="chapter" data-level="5.2.6" data-path="5-Student-performance-level.html"><a href="5-Student-performance-level.html#不同学期不同成绩水平与监护人的关系"><i class="fa fa-check"></i><b>5.2.6</b> 不同学期、不同成绩水平与监护人的关系</a></li>
<li class="chapter" data-level="5.2.7" data-path="5-Student-performance-level.html"><a href="5-Student-performance-level.html#家长是否回答调查问卷成绩水平与家长对学校是否满意的关系"><i class="fa fa-check"></i><b>5.2.7</b> 家长是否回答调查问卷、成绩水平与家长对学校是否满意的关系</a></li>
<li class="chapter" data-level="5.2.8" data-path="5-Student-performance-level.html"><a href="5-Student-performance-level.html#性别逃课次数与学生成绩水平的关系"><i class="fa fa-check"></i><b>5.2.8</b> 性别、逃课次数与学生成绩水平的关系</a></li>
<li class="chapter" data-level="5.2.9" data-path="5-Student-performance-level.html"><a href="5-Student-performance-level.html#举手次数和参加讨论次数与成绩水平关系"><i class="fa fa-check"></i><b>5.2.9</b> 举手次数和参加讨论次数与成绩水平关系</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="5-Student-performance-level.html"><a href="5-Student-performance-level.html#模型建立-1"><i class="fa fa-check"></i><b>5.3</b> 模型建立</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="5-Student-performance-level.html"><a href="5-Student-performance-level.html#回归树模型建立"><i class="fa fa-check"></i><b>5.3.1</b> 回归树模型建立</a></li>
<li class="chapter" data-level="5.3.2" data-path="5-Student-performance-level.html"><a href="5-Student-performance-level.html#随机数模型"><i class="fa fa-check"></i><b>5.3.2</b> 随机数模型</a></li>
<li class="chapter" data-level="5.3.3" data-path="5-Student-performance-level.html"><a href="5-Student-performance-level.html#svm建模-支持向量机需要再研究"><i class="fa fa-check"></i><b>5.3.3</b> SVM建模-支持向量机(需要再研究)</a></li>
<li class="chapter" data-level="5.3.4" data-path="5-Student-performance-level.html"><a href="5-Student-performance-level.html#模型融合"><i class="fa fa-check"></i><b>5.3.4</b> 模型融合</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="5-Student-performance-level.html"><a href="5-Student-performance-level.html#mlr3模型建立"><i class="fa fa-check"></i><b>5.4</b> mlr3模型建立</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="5-Student-performance-level.html"><a href="5-Student-performance-level.html#回归树模型-1"><i class="fa fa-check"></i><b>5.4.1</b> 回归树模型</a></li>
<li class="chapter" data-level="5.4.2" data-path="5-Student-performance-level.html"><a href="5-Student-performance-level.html#随机森林模型"><i class="fa fa-check"></i><b>5.4.2</b> 随机森林模型</a></li>
<li class="chapter" data-level="5.4.3" data-path="5-Student-performance-level.html"><a href="5-Student-performance-level.html#支持向量机模型"><i class="fa fa-check"></i><b>5.4.3</b> 支持向量机模型</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="6-mass-shoot.html"><a href="6-mass-shoot.html"><i class="fa fa-check"></i><b>6</b> 美国大规模枪击案</a>
<ul>
<li class="chapter" data-level="6.1" data-path="6-mass-shoot.html"><a href="6-mass-shoot.html#变量说明"><i class="fa fa-check"></i><b>6.1</b> 变量说明</a></li>
<li class="chapter" data-level="6.2" data-path="6-mass-shoot.html"><a href="6-mass-shoot.html#描述性分析-1"><i class="fa fa-check"></i><b>6.2</b> 描述性分析</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="6-mass-shoot.html"><a href="6-mass-shoot.html#枪击案中伤亡人数"><i class="fa fa-check"></i><b>6.2.1</b> 枪击案中伤亡人数</a></li>
<li class="chapter" data-level="6.2.2" data-path="6-mass-shoot.html"><a href="6-mass-shoot.html#绘制枪击案频率伤亡总人数和平均伤亡人数月为单位"><i class="fa fa-check"></i><b>6.2.2</b> 绘制枪击案频率、伤亡总人数和平均伤亡人数（月为单位）</a></li>
<li class="chapter" data-level="6.2.3" data-path="6-mass-shoot.html"><a href="6-mass-shoot.html#枪手与种族之间的关系"><i class="fa fa-check"></i><b>6.2.3</b> 枪手与种族之间的关系</a></li>
<li class="chapter" data-level="6.2.4" data-path="6-mass-shoot.html"><a href="6-mass-shoot.html#杀手性别和精神状况"><i class="fa fa-check"></i><b>6.2.4</b> 杀手性别和精神状况</a></li>
<li class="chapter" data-level="6.2.5" data-path="6-mass-shoot.html"><a href="6-mass-shoot.html#伤亡水平和不同伤亡水平伤亡人数"><i class="fa fa-check"></i><b>6.2.5</b> 伤亡水平和不同伤亡水平伤亡人数</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="6-mass-shoot.html"><a href="6-mass-shoot.html#枪击发生地的可视化地图"><i class="fa fa-check"></i><b>6.3</b> 枪击发生地的可视化（地图）</a></li>
<li class="chapter" data-level="6.4" data-path="6-mass-shoot.html"><a href="6-mass-shoot.html#枪击案发生地点是否露天"><i class="fa fa-check"></i><b>6.4</b> 枪击案发生地点（是否露天）</a></li>
<li class="chapter" data-level="6.5" data-path="6-mass-shoot.html"><a href="6-mass-shoot.html#不同枪击案起因"><i class="fa fa-check"></i><b>6.5</b> 不同枪击案起因</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="7-mushrooms.html"><a href="7-mushrooms.html"><i class="fa fa-check"></i><b>7</b> 毒蘑菇分析</a>
<ul>
<li class="chapter" data-level="7.1" data-path="7-mushrooms.html"><a href="7-mushrooms.html#变量说明-1"><i class="fa fa-check"></i><b>7.1</b> 变量说明</a></li>
<li class="chapter" data-level="7.2" data-path="7-mushrooms.html"><a href="7-mushrooms.html#数据预处理-统计每列因子水品个数"><i class="fa fa-check"></i><b>7.2</b> 数据预处理-统计每列因子水品个数</a></li>
<li class="chapter" data-level="7.3" data-path="7-mushrooms.html"><a href="7-mushrooms.html#统计建模"><i class="fa fa-check"></i><b>7.3</b> 统计建模</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="7-mushrooms.html"><a href="7-mushrooms.html#随机森林模型-mlr3"><i class="fa fa-check"></i><b>7.3.1</b> 随机森林模型-mlr3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="8-Movies.html"><a href="8-Movies.html"><i class="fa fa-check"></i><b>8</b> 电影</a>
<ul>
<li class="chapter" data-level="8.1" data-path="8-Movies.html"><a href="8-Movies.html#数据"><i class="fa fa-check"></i><b>8.1</b> 数据</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="8-Movies.html"><a href="8-Movies.html#录入"><i class="fa fa-check"></i><b>8.1.1</b> 录入</a></li>
<li class="chapter" data-level="8.1.2" data-path="8-Movies.html"><a href="8-Movies.html#数据概览"><i class="fa fa-check"></i><b>8.1.2</b> 数据概览</a></li>
<li class="chapter" data-level="8.1.3" data-path="8-Movies.html"><a href="8-Movies.html#sec:top-genres"><i class="fa fa-check"></i><b>8.1.3</b> 筛选电影类型</a></li>
<li class="chapter" data-level="8.1.4" data-path="8-Movies.html"><a href="8-Movies.html#sec:credits"><i class="fa fa-check"></i><b>8.1.4</b> 演职人员</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="8-Movies.html"><a href="8-Movies.html#数据探索"><i class="fa fa-check"></i><b>8.2</b> 数据探索</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="8-Movies.html"><a href="8-Movies.html#投票数量"><i class="fa fa-check"></i><b>8.2.1</b> 投票数量</a></li>
<li class="chapter" data-level="8.2.2" data-path="8-Movies.html"><a href="8-Movies.html#评分"><i class="fa fa-check"></i><b>8.2.2</b> 评分</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="8-Movies.html"><a href="8-Movies.html#电影类型"><i class="fa fa-check"></i><b>8.3</b> 电影类型</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="8-Movies.html"><a href="8-Movies.html#电影类型的数量"><i class="fa fa-check"></i><b>8.3.1</b> 电影类型的数量</a></li>
<li class="chapter" data-level="8.3.2" data-path="8-Movies.html"><a href="8-Movies.html#不同类型电影的评分"><i class="fa fa-check"></i><b>8.3.2</b> 不同类型电影的评分</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="8-Movies.html"><a href="8-Movies.html#最受欢迎的演员和导演"><i class="fa fa-check"></i><b>8.4</b> 最受欢迎的演员和导演</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="8-Movies.html"><a href="8-Movies.html#section"><i class="fa fa-check"></i><b>8.4.1</b> </a></li>
<li class="chapter" data-level="8.4.2" data-path="8-Movies.html"><a href="8-Movies.html#指导最多电影的导演"><i class="fa fa-check"></i><b>8.4.2</b> 指导最多电影的导演</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="8-Movies.html"><a href="8-Movies.html#keywords"><i class="fa fa-check"></i><b>8.5</b> keywords</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="8-Movies.html"><a href="8-Movies.html#使用最多的关键词"><i class="fa fa-check"></i><b>8.5.1</b> 使用最多的关键词</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="8-Movies.html"><a href="8-Movies.html#电影推荐"><i class="fa fa-check"></i><b>8.6</b> 电影推荐</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="8-Movies.html"><a href="8-Movies.html#基于类型和语言的简单推荐"><i class="fa fa-check"></i><b>8.6.1</b> 基于类型和语言的简单推荐</a></li>
<li class="chapter" data-level="8.6.2" data-path="8-Movies.html"><a href="8-Movies.html#基于电影内容的推荐演员导演类型"><i class="fa fa-check"></i><b>8.6.2</b> 基于电影内容的推荐（演员、导演、类型）</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>附录</b></span></li>
<li class="chapter" data-level="A" data-path="23-appendix.html"><a href="23-appendix.html"><i class="fa fa-check"></i><b>A</b> 附录</a></li>
<li class="chapter" data-level="" data-path="24-references.html"><a href="24-references.html"><i class="fa fa-check"></i>参考文献</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Kaggle数据项目实战</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="movies" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">第 8 章</span> 电影<a href="8-Movies.html#movies" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="数据" class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> 数据<a href="8-Movies.html#数据" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="录入" class="section level3 hasAnchor" number="8.1.1">
<h3><span class="header-section-number">8.1.1</span> 录入<a href="8-Movies.html#录入" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="8-Movies.html#cb229-1" aria-hidden="true" tabindex="-1"></a>movies <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/movies/tmdb_5000_movies.csv&quot;</span>,</span>
<span id="cb229-2"><a href="8-Movies.html#cb229-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">na =</span> <span class="st">&quot;NA&quot;</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span></span>
<span id="cb229-3"><a href="8-Movies.html#cb229-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb229-4"><a href="8-Movies.html#cb229-4" aria-hidden="true" tabindex="-1"></a>credits <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/movies/tmdb_5000_credits.csv&quot;</span>,</span>
<span id="cb229-5"><a href="8-Movies.html#cb229-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">na =</span> <span class="st">&quot;NA&quot;</span>,</span>
<span id="cb229-6"><a href="8-Movies.html#cb229-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">show_col_types =</span> <span class="cn">FALSE</span></span>
<span id="cb229-7"><a href="8-Movies.html#cb229-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="数据概览" class="section level3 hasAnchor" number="8.1.2">
<h3><span class="header-section-number">8.1.2</span> 数据概览<a href="8-Movies.html#数据概览" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="8-Movies.html#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(movies)</span></code></pre></div>
<pre><code>## Rows: 4,803
## Columns: 20
## $ budget               &lt;dbl&gt; 2.37e+08, 3.00e+08, 2.45e+08, 2.50e+08~
## $ genres               &lt;chr&gt; &quot;[{\&quot;id\&quot;: 28, \&quot;name\&quot;: \&quot;Action\&quot;}, ~
## $ homepage             &lt;chr&gt; &quot;http://www.avatarmovie.com/&quot;, &quot;http:/~
## $ id                   &lt;dbl&gt; 19995, 285, 206647, 49026, 49529, 559,~
## $ keywords             &lt;chr&gt; &quot;[{\&quot;id\&quot;: 1463, \&quot;name\&quot;: \&quot;culture c~
## $ original_language    &lt;chr&gt; &quot;en&quot;, &quot;en&quot;, &quot;en&quot;, &quot;en&quot;, &quot;en&quot;, &quot;en&quot;, &quot;e~
## $ original_title       &lt;chr&gt; &quot;Avatar&quot;, &quot;Pirates of the Caribbean: A~
## $ overview             &lt;chr&gt; &quot;In the 22nd century, a paraplegic Mar~
## $ popularity           &lt;dbl&gt; 150.43758, 139.08262, 107.37679, 112.3~
## $ production_companies &lt;chr&gt; &quot;[{\&quot;name\&quot;: \&quot;Ingenious Film Partners~
## $ production_countries &lt;chr&gt; &quot;[{\&quot;iso_3166_1\&quot;: \&quot;US\&quot;, \&quot;name\&quot;: \~
## $ release_date         &lt;date&gt; 2009-12-10, 2007-05-19, 2015-10-26, 2~
## $ revenue              &lt;dbl&gt; 2787965087, 961000000, 880674609, 1084~
## $ runtime              &lt;dbl&gt; 162, 169, 148, 165, 132, 139, 100, 141~
## $ spoken_languages     &lt;chr&gt; &quot;[{\&quot;iso_639_1\&quot;: \&quot;en\&quot;, \&quot;name\&quot;: \&quot;~
## $ status               &lt;chr&gt; &quot;Released&quot;, &quot;Released&quot;, &quot;Released&quot;, &quot;R~
## $ tagline              &lt;chr&gt; &quot;Enter the World of Pandora.&quot;, &quot;At the~
## $ title                &lt;chr&gt; &quot;Avatar&quot;, &quot;Pirates of the Caribbean: A~
## $ vote_average         &lt;dbl&gt; 7.2, 6.9, 6.3, 7.6, 6.1, 5.9, 7.4, 7.3~
## $ vote_count           &lt;dbl&gt; 11800, 4500, 4466, 9106, 2124, 3576, 3~</code></pre>
<p>注意到有5列都是以JSON格式展现的（genres, keywords, production_companies, production_countries, and spoken_languages）。我们需要对这几列数据进行处理。</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="8-Movies.html#cb232-1" aria-hidden="true" tabindex="-1"></a>keywords <span class="ot">&lt;-</span> movies <span class="sc">%&gt;%</span></span>
<span id="cb232-2"><a href="8-Movies.html#cb232-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(keywords) <span class="sc">&gt;</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="co"># 剔除keywords中的空白</span></span>
<span id="cb232-3"><a href="8-Movies.html#cb232-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb232-4"><a href="8-Movies.html#cb232-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">js =</span> <span class="fu">map</span>(keywords, fromJSON)</span>
<span id="cb232-5"><a href="8-Movies.html#cb232-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb232-6"><a href="8-Movies.html#cb232-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(js, <span class="at">names_repair =</span> <span class="st">&quot;unique&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb232-7"><a href="8-Movies.html#cb232-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id...<span class="dv">4</span>, title, <span class="at">keyword =</span> name) <span class="sc">%&gt;%</span></span>
<span id="cb232-8"><a href="8-Movies.html#cb232-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">id =</span> id...<span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb232-9"><a href="8-Movies.html#cb232-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.character, factor)</span>
<span id="cb232-10"><a href="8-Movies.html#cb232-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-11"><a href="8-Movies.html#cb232-11" aria-hidden="true" tabindex="-1"></a>genres <span class="ot">&lt;-</span> movies <span class="sc">%&gt;%</span></span>
<span id="cb232-12"><a href="8-Movies.html#cb232-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(genres) <span class="sc">&gt;</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="co"># 剔除keywords中的空白</span></span>
<span id="cb232-13"><a href="8-Movies.html#cb232-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb232-14"><a href="8-Movies.html#cb232-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">js =</span> <span class="fu">map</span>(genres, fromJSON)</span>
<span id="cb232-15"><a href="8-Movies.html#cb232-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb232-16"><a href="8-Movies.html#cb232-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(js, <span class="at">names_repair =</span> <span class="st">&quot;unique&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb232-17"><a href="8-Movies.html#cb232-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id...<span class="dv">4</span>, title, <span class="at">keyword =</span> name) <span class="sc">%&gt;%</span></span>
<span id="cb232-18"><a href="8-Movies.html#cb232-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">id =</span> id...<span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb232-19"><a href="8-Movies.html#cb232-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.character, factor)</span></code></pre></div>
</div>
<div id="sec:top-genres" class="section level3 hasAnchor" number="8.1.3">
<h3><span class="header-section-number">8.1.3</span> 筛选电影类型<a href="8-Movies.html#sec:top-genres" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>假设电影的类型是按照重要程度进行排序的，越靠后的类型对该电影的定义价值越低，所以我们需要将与每部电影最相关的类型筛选出来。</p>
<p>我们筛选出排名前3的类型保留，其它类型则剔除掉。</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="8-Movies.html#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用传统for循环</span></span>
<span id="cb233-2"><a href="8-Movies.html#cb233-2" aria-hidden="true" tabindex="-1"></a>genres3 <span class="ot">&lt;-</span> genres</span>
<span id="cb233-3"><a href="8-Movies.html#cb233-3" aria-hidden="true" tabindex="-1"></a>genres3<span class="sc">$</span>order <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb233-4"><a href="8-Movies.html#cb233-4" aria-hidden="true" tabindex="-1"></a>genres3<span class="sc">$</span>order[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb233-5"><a href="8-Movies.html#cb233-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-6"><a href="8-Movies.html#cb233-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 将每部电影的类型进行排序</span></span>
<span id="cb233-7"><a href="8-Movies.html#cb233-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">nrow</span>(genres3) <span class="sc">-</span> <span class="dv">1</span>)) {</span>
<span id="cb233-8"><a href="8-Movies.html#cb233-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 将每部电影的第一行设置为1</span></span>
<span id="cb233-9"><a href="8-Movies.html#cb233-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (genres3<span class="sc">$</span>id[i <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">!=</span> genres3<span class="sc">$</span>id[i]) { <span class="co"># 此条件表示为新电影</span></span>
<span id="cb233-10"><a href="8-Movies.html#cb233-10" aria-hidden="true" tabindex="-1"></a>    genres3<span class="sc">$</span>order[i <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb233-11"><a href="8-Movies.html#cb233-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 将每部电影的类型按顺序+1</span></span>
<span id="cb233-12"><a href="8-Movies.html#cb233-12" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb233-13"><a href="8-Movies.html#cb233-13" aria-hidden="true" tabindex="-1"></a>    genres3<span class="sc">$</span>order[i <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> (genres3<span class="sc">$</span>order[i]) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb233-14"><a href="8-Movies.html#cb233-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb233-15"><a href="8-Movies.html#cb233-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="8-Movies.html#cb234-1" aria-hidden="true" tabindex="-1"></a>genres3 <span class="ot">&lt;-</span> genres <span class="sc">%&gt;%</span></span>
<span id="cb234-2"><a href="8-Movies.html#cb234-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span></span>
<span id="cb234-3"><a href="8-Movies.html#cb234-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">order =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb234-4"><a href="8-Movies.html#cb234-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(order <span class="sc">&lt;=</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb234-5"><a href="8-Movies.html#cb234-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb234-6"><a href="8-Movies.html#cb234-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> order,</span>
<span id="cb234-7"><a href="8-Movies.html#cb234-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> keyword</span>
<span id="cb234-8"><a href="8-Movies.html#cb234-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb234-9"><a href="8-Movies.html#cb234-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">genre_1 =</span> <span class="st">`</span><span class="at">1</span><span class="st">`</span>, <span class="at">genre_2 =</span> <span class="st">`</span><span class="at">2</span><span class="st">`</span>, <span class="at">genre_3 =</span> <span class="st">`</span><span class="at">3</span><span class="st">`</span>)</span>
<span id="cb234-10"><a href="8-Movies.html#cb234-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(genres3, <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 5
## # Groups:   id [5]
##       id title                                genre_1 genre_2 genre_3
##    &lt;dbl&gt; &lt;fct&gt;                                &lt;fct&gt;   &lt;fct&gt;   &lt;fct&gt;  
## 1  19995 Avatar                               Action  Advent~ Fantasy
## 2    285 Pirates of the Caribbean: At World&#39;~ Advent~ Fantasy Action 
## 3 206647 Spectre                              Action  Advent~ Crime  
## 4  49026 The Dark Knight Rises                Action  Crime   Drama  
## 5  49529 John Carter                          Action  Advent~ Scienc~</code></pre>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="8-Movies.html#cb236-1" aria-hidden="true" tabindex="-1"></a>movies <span class="ot">&lt;-</span> <span class="fu">left_join</span>(movies, genres3 <span class="sc">%&gt;%</span> <span class="fu">select</span>(id, genre_1, genre_2, genre_3), <span class="at">by =</span> <span class="st">&quot;id&quot;</span>)</span></code></pre></div>
</div>
<div id="sec:credits" class="section level3 hasAnchor" number="8.1.4">
<h3><span class="header-section-number">8.1.4</span> 演职人员<a href="8-Movies.html#sec:credits" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="8-Movies.html#cb237-1" aria-hidden="true" tabindex="-1"></a>cast <span class="ot">&lt;-</span> credits <span class="sc">%&gt;%</span></span>
<span id="cb237-2"><a href="8-Movies.html#cb237-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(cast) <span class="sc">&gt;</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="co"># 剔除keywords中的空白</span></span>
<span id="cb237-3"><a href="8-Movies.html#cb237-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb237-4"><a href="8-Movies.html#cb237-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">js =</span> <span class="fu">map</span>(cast, fromJSON)</span>
<span id="cb237-5"><a href="8-Movies.html#cb237-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb237-6"><a href="8-Movies.html#cb237-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(js) <span class="sc">%&gt;%</span></span>
<span id="cb237-7"><a href="8-Movies.html#cb237-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>cast, <span class="sc">-</span>crew, <span class="sc">-</span>credit_id) <span class="sc">%&gt;%</span> <span class="co"># 剔除JSON数据</span></span>
<span id="cb237-8"><a href="8-Movies.html#cb237-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">actor =</span> name, <span class="at">movie_cast_id =</span> cast_id, <span class="at">actor_id =</span> id) <span class="sc">%&gt;%</span></span>
<span id="cb237-9"><a href="8-Movies.html#cb237-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.character, factor)</span>
<span id="cb237-10"><a href="8-Movies.html#cb237-10" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(cast)</span></code></pre></div>
<pre><code>## Rows: 106,257
## Columns: 8
## $ movie_id      &lt;dbl&gt; 19995, 19995, 19995, 19995, 19995, 19995, 199~
## $ title         &lt;fct&gt; &quot;Avatar&quot;, &quot;Avatar&quot;, &quot;Avatar&quot;, &quot;Avatar&quot;, &quot;Avat~
## $ movie_cast_id &lt;int&gt; 242, 3, 25, 4, 5, 8, 7, 9, 11, 10, 12, 13, 32~
## $ character     &lt;fct&gt; &quot;Jake Sully&quot;, &quot;Neytiri&quot;, &quot;Dr. Grace Augustine~
## $ gender        &lt;int&gt; 2, 1, 1, 2, 1, 2, 2, 1, 2, 2, 2, 2, 2, 2, 2, ~
## $ actor_id      &lt;int&gt; 65731, 8691, 10205, 32747, 17647, 1771, 59231~
## $ actor         &lt;fct&gt; &quot;Sam Worthington&quot;, &quot;Zoe Saldana&quot;, &quot;Sigourney ~
## $ order         &lt;int&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,~</code></pre>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="8-Movies.html#cb239-1" aria-hidden="true" tabindex="-1"></a>cast1 <span class="ot">&lt;-</span> cast <span class="sc">%&gt;%</span> <span class="co"># 用作之后的可视化</span></span>
<span id="cb239-2"><a href="8-Movies.html#cb239-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(actor)</span></code></pre></div>
<p>由于数据量庞大，我们筛选其中一位演员对此数据进行初步观察处理。原项目选择了小李子，不过我这里选择了一位女性演员，看看寡姐的情况如何。</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="8-Movies.html#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(cast <span class="sc">%&gt;%</span></span>
<span id="cb240-2"><a href="8-Movies.html#cb240-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(actor <span class="sc">==</span> <span class="st">&quot;Scarlett Johansson&quot;</span>))</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:right;">
movie_id
</th>
<th style="text-align:left;">
title
</th>
<th style="text-align:right;">
movie_cast_id
</th>
<th style="text-align:left;">
character
</th>
<th style="text-align:right;">
gender
</th>
<th style="text-align:right;">
actor_id
</th>
<th style="text-align:left;">
actor
</th>
<th style="text-align:right;">
order
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
99861
</td>
<td style="text-align:left;">
Avengers: Age of Ultron
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
Natasha Romanoff / Black Widow
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1245
</td>
<td style="text-align:left;">
Scarlett Johansson
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
24428
</td>
<td style="text-align:left;">
The Avengers
</td>
<td style="text-align:right;">
34
</td>
<td style="text-align:left;">
Natasha Romanoff / Black Widow
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1245
</td>
<td style="text-align:left;">
Scarlett Johansson
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
271110
</td>
<td style="text-align:left;">
Captain America: Civil War
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:left;">
Natasha Romanoff / Black Widow
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1245
</td>
<td style="text-align:left;">
Scarlett Johansson
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
278927
</td>
<td style="text-align:left;">
The Jungle Book
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Kaa (voice)
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1245
</td>
<td style="text-align:left;">
Scarlett Johansson
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
10138
</td>
<td style="text-align:left;">
Iron Man 2
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Natalie Rushman / Natasha Romanoff / Black Widow
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1245
</td>
<td style="text-align:left;">
Scarlett Johansson
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
100402
</td>
<td style="text-align:left;">
Captain America: The Winter Soldier
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
Natasha Romanoff / Black Widow
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1245
</td>
<td style="text-align:left;">
Scarlett Johansson
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
1635
</td>
<td style="text-align:left;">
The Island
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:left;">
Jordan Two Delta / Sarah Jordan
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1245
</td>
<td style="text-align:left;">
Scarlett Johansson
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
547
</td>
<td style="text-align:left;">
The Horse Whisperer
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Grace MacLean
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1245
</td>
<td style="text-align:left;">
Scarlett Johansson
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
9676
</td>
<td style="text-align:left;">
The Black Dahlia
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Kay Lake
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1245
</td>
<td style="text-align:left;">
Scarlett Johansson
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
8285
</td>
<td style="text-align:left;">
The Spirit
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Silken Floss
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1245
</td>
<td style="text-align:left;">
Scarlett Johansson
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
74465
</td>
<td style="text-align:left;">
We Bought a Zoo
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Kelly Foster
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1245
</td>
<td style="text-align:left;">
Scarlett Johansson
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
240832
</td>
<td style="text-align:left;">
Lucy
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Lucy Miller
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1245
</td>
<td style="text-align:left;">
Scarlett Johansson
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
10184
</td>
<td style="text-align:left;">
He’s Just Not That Into You
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
Anna Marks
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1245
</td>
<td style="text-align:left;">
Scarlett Johansson
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:right;">
1124
</td>
<td style="text-align:left;">
The Prestige
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:left;">
Olivia Wenscombe
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1245
</td>
<td style="text-align:left;">
Scarlett Johansson
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
12184
</td>
<td style="text-align:left;">
The Other Boleyn Girl
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:left;">
Mary Boleyn
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1245
</td>
<td style="text-align:left;">
Scarlett Johansson
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
11836
</td>
<td style="text-align:left;">
The SpongeBob SquarePants Movie
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:left;">
Mindy (voice)
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1245
</td>
<td style="text-align:left;">
Scarlett Johansson
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:right;">
8869
</td>
<td style="text-align:left;">
Eight Legged Freaks
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:left;">
Ashley Parker
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1245
</td>
<td style="text-align:left;">
Scarlett Johansson
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
1901
</td>
<td style="text-align:left;">
In Good Company
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Alex Foreman
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1245
</td>
<td style="text-align:left;">
Scarlett Johansson
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
152601
</td>
<td style="text-align:left;">
Her
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
Samantha (voice)
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1245
</td>
<td style="text-align:left;">
Scarlett Johansson
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
270487
</td>
<td style="text-align:left;">
Hail, Caesar!
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
DeeAnna Moran
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1245
</td>
<td style="text-align:left;">
Scarlett Johansson
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
5038
</td>
<td style="text-align:left;">
Vicky Cristina Barcelona
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Cristina
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1245
</td>
<td style="text-align:left;">
Scarlett Johansson
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
116
</td>
<td style="text-align:left;">
Match Point
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:left;">
Nola Rice
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1245
</td>
<td style="text-align:left;">
Scarlett Johansson
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
97370
</td>
<td style="text-align:left;">
Under the Skin
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Laura
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1245
</td>
<td style="text-align:left;">
Scarlett Johansson
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
3635
</td>
<td style="text-align:left;">
Girl with a Pearl Earring
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Griet
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1245
</td>
<td style="text-align:left;">
Scarlett Johansson
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
138697
</td>
<td style="text-align:left;">
Don Jon
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
Barbara Sugarman
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1245
</td>
<td style="text-align:left;">
Scarlett Johansson
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1548
</td>
<td style="text-align:left;">
Ghost World
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Rebecca
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1245
</td>
<td style="text-align:left;">
Scarlett Johansson
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
153
</td>
<td style="text-align:left;">
Lost in Translation
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Charlotte
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1245
</td>
<td style="text-align:left;">
Scarlett Johansson
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
512
</td>
<td style="text-align:left;">
Scoop
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Sondra Pransky
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1245
</td>
<td style="text-align:left;">
Scarlett Johansson
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
<p>order列包括了数字0~4，是否代表了演员在这部电影里的番位？在<code>超体（Lucy）</code>中，寡姐是无可争议的第一番位，我们来验证下。</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="8-Movies.html#cb241-1" aria-hidden="true" tabindex="-1"></a>cast <span class="sc">%&gt;%</span></span>
<span id="cb241-2"><a href="8-Movies.html#cb241-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(title <span class="sc">==</span> <span class="st">&quot;Lucy&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb241-3"><a href="8-Movies.html#cb241-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(title, order, actor, character) <span class="sc">%&gt;%</span></span>
<span id="cb241-4"><a href="8-Movies.html#cb241-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(order)</span></code></pre></div>
<pre><code>## # A tibble: 59 x 4
##    title order actor                character              
##    &lt;fct&gt; &lt;int&gt; &lt;fct&gt;                &lt;fct&gt;                  
##  1 Lucy      0 Scarlett Johansson   Lucy Miller            
##  2 Lucy      1 Morgan Freeman       Professor Samuel Norman
##  3 Lucy      2 Choi Min-sik         Mr. Jang               
##  4 Lucy      3 Amr Waked            Pierre Del Rio         
##  5 Lucy      4 Julian Rhind-Tutt    The Limey              
##  6 Lucy      5 Pilou Asb&lt;U+00E6&gt;k          Richard                
##  7 Lucy      6 Analeigh Tipton      Caroline               
##  8 Lucy      7 Nicolas Phongpheth   Jii                    
##  9 Lucy      8 Jan Oliver Schroeder German Mule            
## 10 Lucy      9 Luca Angeletti       Italian Mule           
## # ... with 49 more rows</code></pre>
<p>果然没错。原来超体的演员只有59位，吕克贝松真是赚的盆满钵满。</p>
<p>与genres一样，我们同样选择每部电影中排名前3位的主演作为后续分析的基础数据。</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="8-Movies.html#cb243-1" aria-hidden="true" tabindex="-1"></a>cast <span class="ot">&lt;-</span> cast <span class="sc">%&gt;%</span></span>
<span id="cb243-2"><a href="8-Movies.html#cb243-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(movie_id) <span class="sc">%&gt;%</span></span>
<span id="cb243-3"><a href="8-Movies.html#cb243-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">order3 =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb243-4"><a href="8-Movies.html#cb243-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(order3 <span class="sc">&lt;=</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb243-5"><a href="8-Movies.html#cb243-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(movie_id, title, actor, order3) <span class="sc">%&gt;%</span></span>
<span id="cb243-6"><a href="8-Movies.html#cb243-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb243-7"><a href="8-Movies.html#cb243-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> order3,</span>
<span id="cb243-8"><a href="8-Movies.html#cb243-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> actor</span>
<span id="cb243-9"><a href="8-Movies.html#cb243-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb243-10"><a href="8-Movies.html#cb243-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">actor_1 =</span> <span class="st">`</span><span class="at">1</span><span class="st">`</span>, <span class="at">actor_2 =</span> <span class="st">`</span><span class="at">2</span><span class="st">`</span>, <span class="at">actor_3 =</span> <span class="st">`</span><span class="at">3</span><span class="st">`</span>)</span>
<span id="cb243-11"><a href="8-Movies.html#cb243-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cast, <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 5
## # Groups:   movie_id [5]
##   movie_id title                              actor_1 actor_2 actor_3
##      &lt;dbl&gt; &lt;fct&gt;                              &lt;fct&gt;   &lt;fct&gt;   &lt;fct&gt;  
## 1    19995 Avatar                             Sam Wo~ Zoe Sa~ Sigour~
## 2      285 Pirates of the Caribbean: At Worl~ Johnny~ Orland~ Keira ~
## 3   206647 Spectre                            Daniel~ Christ~ Léa Se~
## 4    49026 The Dark Knight Rises              Christ~ Michae~ Gary O~
## 5    49529 John Carter                        Taylor~ Lynn C~ Samant~</code></pre>
<p>最后，我们将演员数据和最初的电影数据合并。</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="8-Movies.html#cb245-1" aria-hidden="true" tabindex="-1"></a>movies <span class="ot">&lt;-</span> <span class="fu">left_join</span>(movies,</span>
<span id="cb245-2"><a href="8-Movies.html#cb245-2" aria-hidden="true" tabindex="-1"></a>  cast <span class="sc">%&gt;%</span></span>
<span id="cb245-3"><a href="8-Movies.html#cb245-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="at">id =</span> movie_id, actor_1, actor_2, actor_3),</span>
<span id="cb245-4"><a href="8-Movies.html#cb245-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">&quot;id&quot;</span></span>
<span id="cb245-5"><a href="8-Movies.html#cb245-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb245-6"><a href="8-Movies.html#cb245-6" aria-hidden="true" tabindex="-1"></a>movies</span></code></pre></div>
<pre><code>## # A tibble: 4,803 x 26
##       budget genres         homepage     id keywords original_langua~
##        &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;           
##  1 237000000 &quot;[{\&quot;id\&quot;: 28~ http://~  19995 &quot;[{\&quot;id~ en              
##  2 300000000 &quot;[{\&quot;id\&quot;: 12~ http://~    285 &quot;[{\&quot;id~ en              
##  3 245000000 &quot;[{\&quot;id\&quot;: 28~ http://~ 206647 &quot;[{\&quot;id~ en              
##  4 250000000 &quot;[{\&quot;id\&quot;: 28~ http://~  49026 &quot;[{\&quot;id~ en              
##  5 260000000 &quot;[{\&quot;id\&quot;: 28~ http://~  49529 &quot;[{\&quot;id~ en              
##  6 258000000 &quot;[{\&quot;id\&quot;: 14~ http://~    559 &quot;[{\&quot;id~ en              
##  7 260000000 &quot;[{\&quot;id\&quot;: 16~ http://~  38757 &quot;[{\&quot;id~ en              
##  8 280000000 &quot;[{\&quot;id\&quot;: 28~ http://~  99861 &quot;[{\&quot;id~ en              
##  9 250000000 &quot;[{\&quot;id\&quot;: 12~ http://~    767 &quot;[{\&quot;id~ en              
## 10 250000000 &quot;[{\&quot;id\&quot;: 28~ http://~ 209112 &quot;[{\&quot;id~ en              
## # ... with 4,793 more rows, and 20 more variables:
## #   original_title &lt;chr&gt;, overview &lt;chr&gt;, popularity &lt;dbl&gt;,
## #   production_companies &lt;chr&gt;, production_countries &lt;chr&gt;,
## #   release_date &lt;date&gt;, revenue &lt;dbl&gt;, runtime &lt;dbl&gt;,
## #   spoken_languages &lt;chr&gt;, status &lt;chr&gt;, tagline &lt;chr&gt;,
## #   title &lt;chr&gt;, vote_average &lt;dbl&gt;, vote_count &lt;dbl&gt;,
## #   genre_1 &lt;fct&gt;, genre_2 &lt;fct&gt;, genre_3 &lt;fct&gt;, actor_1 &lt;fct&gt;, ...</code></pre>
<div id="将导演加入movies数据" class="section level4 hasAnchor" number="8.1.4.1">
<h4><span class="header-section-number">8.1.4.1</span> 将导演加入movies数据<a href="8-Movies.html#将导演加入movies数据" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>导演是一部电影的灵魂。</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="8-Movies.html#cb247-1" aria-hidden="true" tabindex="-1"></a>crew <span class="ot">&lt;-</span> credits <span class="sc">%&gt;%</span></span>
<span id="cb247-2"><a href="8-Movies.html#cb247-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(crew) <span class="sc">&gt;</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb247-3"><a href="8-Movies.html#cb247-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">js =</span> <span class="fu">map</span>(crew, fromJSON)) <span class="sc">%&gt;%</span></span>
<span id="cb247-4"><a href="8-Movies.html#cb247-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(js) <span class="sc">%&gt;%</span></span>
<span id="cb247-5"><a href="8-Movies.html#cb247-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>cast, <span class="sc">-</span>crew, <span class="sc">-</span>credit_id) <span class="sc">%&gt;%</span></span>
<span id="cb247-6"><a href="8-Movies.html#cb247-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">crew =</span> name, <span class="at">cres_id =</span> id) <span class="sc">%&gt;%</span></span>
<span id="cb247-7"><a href="8-Movies.html#cb247-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.character, factor)</span>
<span id="cb247-8"><a href="8-Movies.html#cb247-8" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(crew)</span></code></pre></div>
<pre><code>## Rows: 129,581
## Columns: 7
## $ movie_id   &lt;dbl&gt; 19995, 19995, 19995, 19995, 19995, 19995, 19995,~
## $ title      &lt;fct&gt; &quot;Avatar&quot;, &quot;Avatar&quot;, &quot;Avatar&quot;, &quot;Avatar&quot;, &quot;Avatar&quot;~
## $ department &lt;fct&gt; Editing, Art, Sound, Sound, Production, Sound, D~
## $ gender     &lt;int&gt; 0, 2, 0, 0, 1, 2, 2, 2, 2, 2, 2, 2, 0, 1, 2, 0, ~
## $ cres_id    &lt;int&gt; 1721, 496, 900, 900, 1262, 1729, 2710, 2710, 271~
## $ job        &lt;fct&gt; Editor, Production Design, Sound Designer, Super~
## $ crew       &lt;fct&gt; &quot;Stephen E. Rivkin&quot;, &quot;Rick Carter&quot;, &quot;Christopher~</code></pre>
<p>我们来看看一个职员在一部电影中具体能做啥。</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="8-Movies.html#cb249-1" aria-hidden="true" tabindex="-1"></a>crew <span class="sc">%&gt;%</span></span>
<span id="cb249-2"><a href="8-Movies.html#cb249-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(crew <span class="sc">==</span> <span class="st">&quot;Quentin Tarantino&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 32 x 7
##    movie_id title               department gender cres_id job   crew 
##       &lt;dbl&gt; &lt;fct&gt;               &lt;fct&gt;       &lt;int&gt;   &lt;int&gt; &lt;fct&gt; &lt;fct&gt;
##  1    68718 Django Unchained    Directing       2     138 Dire~ Quen~
##  2    68718 Django Unchained    Writing         2     138 Writ~ Quen~
##  3    16869 Inglourious Baster~ Directing       2     138 Dire~ Quen~
##  4    16869 Inglourious Baster~ Writing         2     138 Writ~ Quen~
##  5   273248 The Hateful Eight   Directing       2     138 Dire~ Quen~
##  6   273248 The Hateful Eight   Writing         2     138 Writ~ Quen~
##  7       24 Kill Bill: Vol. 1   Directing       2     138 Dire~ Quen~
##  8       24 Kill Bill: Vol. 1   Writing         2     138 Char~ Quen~
##  9       24 Kill Bill: Vol. 1   Writing         2     138 Writ~ Quen~
## 10      393 Kill Bill: Vol. 2   Directing       2     138 Dire~ Quen~
## # ... with 22 more rows</code></pre>
<p>可以看到，昆汀不仅做导演，还做制片、编剧、摄影等，甚至还参演自己的电影。</p>
<p>不过，大家对一部电影的职员最关注的往往是导演，所以，我们需要从职员表中筛选出导演。然而，部分电影拥有多个导演，有些电影甚至没有导演，我们将这些特殊的剔除，只选择有一位导演的电影。</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="8-Movies.html#cb251-1" aria-hidden="true" tabindex="-1"></a>movies1Director <span class="ot">&lt;-</span> crew <span class="sc">%&gt;%</span></span>
<span id="cb251-2"><a href="8-Movies.html#cb251-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(job <span class="sc">==</span> <span class="st">&quot;Director&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb251-3"><a href="8-Movies.html#cb251-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(movie_id) <span class="sc">%&gt;%</span></span>
<span id="cb251-4"><a href="8-Movies.html#cb251-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb251-5"><a href="8-Movies.html#cb251-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(count <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb251-6"><a href="8-Movies.html#cb251-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-7"><a href="8-Movies.html#cb251-7" aria-hidden="true" tabindex="-1"></a>movies <span class="ot">&lt;-</span> <span class="fu">left_join</span>(movies,</span>
<span id="cb251-8"><a href="8-Movies.html#cb251-8" aria-hidden="true" tabindex="-1"></a>  crew <span class="sc">%&gt;%</span></span>
<span id="cb251-9"><a href="8-Movies.html#cb251-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(job <span class="sc">==</span> <span class="st">&quot;Director&quot;</span> <span class="sc">&amp;</span> movie_id <span class="sc">%in%</span></span>
<span id="cb251-10"><a href="8-Movies.html#cb251-10" aria-hidden="true" tabindex="-1"></a>      movies1Director<span class="sc">$</span>movie_id) <span class="sc">%&gt;%</span></span>
<span id="cb251-11"><a href="8-Movies.html#cb251-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="at">id =</span> movie_id, <span class="at">director =</span> crew),</span>
<span id="cb251-12"><a href="8-Movies.html#cb251-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">&quot;id&quot;</span></span>
<span id="cb251-13"><a href="8-Movies.html#cb251-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb251-14"><a href="8-Movies.html#cb251-14" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(movies)</span></code></pre></div>
<pre><code>## Rows: 4,803
## Columns: 27
## $ budget               &lt;dbl&gt; 2.37e+08, 3.00e+08, 2.45e+08, 2.50e+08~
## $ genres               &lt;chr&gt; &quot;[{\&quot;id\&quot;: 28, \&quot;name\&quot;: \&quot;Action\&quot;}, ~
## $ homepage             &lt;chr&gt; &quot;http://www.avatarmovie.com/&quot;, &quot;http:/~
## $ id                   &lt;dbl&gt; 19995, 285, 206647, 49026, 49529, 559,~
## $ keywords             &lt;chr&gt; &quot;[{\&quot;id\&quot;: 1463, \&quot;name\&quot;: \&quot;culture c~
## $ original_language    &lt;chr&gt; &quot;en&quot;, &quot;en&quot;, &quot;en&quot;, &quot;en&quot;, &quot;en&quot;, &quot;en&quot;, &quot;e~
## $ original_title       &lt;chr&gt; &quot;Avatar&quot;, &quot;Pirates of the Caribbean: A~
## $ overview             &lt;chr&gt; &quot;In the 22nd century, a paraplegic Mar~
## $ popularity           &lt;dbl&gt; 150.43758, 139.08262, 107.37679, 112.3~
## $ production_companies &lt;chr&gt; &quot;[{\&quot;name\&quot;: \&quot;Ingenious Film Partners~
## $ production_countries &lt;chr&gt; &quot;[{\&quot;iso_3166_1\&quot;: \&quot;US\&quot;, \&quot;name\&quot;: \~
## $ release_date         &lt;date&gt; 2009-12-10, 2007-05-19, 2015-10-26, 2~
## $ revenue              &lt;dbl&gt; 2787965087, 961000000, 880674609, 1084~
## $ runtime              &lt;dbl&gt; 162, 169, 148, 165, 132, 139, 100, 141~
## $ spoken_languages     &lt;chr&gt; &quot;[{\&quot;iso_639_1\&quot;: \&quot;en\&quot;, \&quot;name\&quot;: \&quot;~
## $ status               &lt;chr&gt; &quot;Released&quot;, &quot;Released&quot;, &quot;Released&quot;, &quot;R~
## $ tagline              &lt;chr&gt; &quot;Enter the World of Pandora.&quot;, &quot;At the~
## $ title                &lt;chr&gt; &quot;Avatar&quot;, &quot;Pirates of the Caribbean: A~
## $ vote_average         &lt;dbl&gt; 7.2, 6.9, 6.3, 7.6, 6.1, 5.9, 7.4, 7.3~
## $ vote_count           &lt;dbl&gt; 11800, 4500, 4466, 9106, 2124, 3576, 3~
## $ genre_1              &lt;fct&gt; Action, Adventure, Action, Action, Act~
## $ genre_2              &lt;fct&gt; Adventure, Fantasy, Adventure, Crime, ~
## $ genre_3              &lt;fct&gt; Fantasy, Action, Crime, Drama, Science~
## $ actor_1              &lt;fct&gt; &quot;Sam Worthington&quot;, &quot;Johnny Depp&quot;, &quot;Dan~
## $ actor_2              &lt;fct&gt; &quot;Zoe Saldana&quot;, &quot;Orlando Bloom&quot;, &quot;Chris~
## $ actor_3              &lt;fct&gt; &quot;Sigourney Weaver&quot;, &quot;Keira Knightley&quot;,~
## $ director             &lt;fct&gt; &quot;James Cameron&quot;, &quot;Gore Verbinski&quot;, &quot;Sa~</code></pre>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="8-Movies.html#cb253-1" aria-hidden="true" tabindex="-1"></a>movies <span class="ot">&lt;-</span> movies <span class="sc">%&gt;%</span></span>
<span id="cb253-2"><a href="8-Movies.html#cb253-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb253-3"><a href="8-Movies.html#cb253-3" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>genres, <span class="sc">-</span>keywords, <span class="sc">-</span>production_companies,</span>
<span id="cb253-4"><a href="8-Movies.html#cb253-4" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>production_countries, <span class="sc">-</span>spoken_languages</span>
<span id="cb253-5"><a href="8-Movies.html#cb253-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</div>
</div>
</div>
<div id="数据探索" class="section level2 hasAnchor" number="8.2">
<h2><span class="header-section-number">8.2</span> 数据探索<a href="8-Movies.html#数据探索" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="投票数量" class="section level3 hasAnchor" number="8.2.1">
<h3><span class="header-section-number">8.2.1</span> 投票数量<a href="8-Movies.html#投票数量" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="8-Movies.html#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(movies<span class="sc">$</span>vote_count)</span></code></pre></div>
<pre><code>## [1]     0 13752</code></pre>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="8-Movies.html#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(movies, <span class="fu">aes</span>(<span class="at">x =</span> vote_count)) <span class="sc">+</span></span>
<span id="cb256-2"><a href="8-Movies.html#cb256-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 投票数超过10000的几乎在图中显示不出，我们只关注5000以下的。</span></span>
<span id="cb256-3"><a href="8-Movies.html#cb256-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">binwidth =</span> <span class="dv">50</span>) <span class="sc">+</span></span>
<span id="cb256-4"><a href="8-Movies.html#cb256-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb256-5"><a href="8-Movies.html#cb256-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb256-6"><a href="8-Movies.html#cb256-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">5000</span>, <span class="at">by =</span> <span class="dv">500</span>),</span>
<span id="cb256-7"><a href="8-Movies.html#cb256-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> comma</span>
<span id="cb256-8"><a href="8-Movies.html#cb256-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb256-9"><a href="8-Movies.html#cb256-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5000</span>)) <span class="sc">+</span></span>
<span id="cb256-10"><a href="8-Movies.html#cb256-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;投票数量&quot;</span>, <span class="at">y =</span> <span class="st">&quot;电影数量&quot;</span>)</span></code></pre></div>
<p><img src="8-Movies_files/figure-html/unnamed-chunk-14-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>那么投票数量多的电影和它的评分是否关联呢？</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="8-Movies.html#cb257-1" aria-hidden="true" tabindex="-1"></a>movies <span class="sc">%&gt;%</span></span>
<span id="cb257-2"><a href="8-Movies.html#cb257-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="dv">20</span>, <span class="at">wt =</span> vote_count) <span class="sc">%&gt;%</span></span>
<span id="cb257-3"><a href="8-Movies.html#cb257-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(title, vote_count), <span class="at">y =</span> vote_count)) <span class="sc">+</span></span>
<span id="cb257-4"><a href="8-Movies.html#cb257-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb257-5"><a href="8-Movies.html#cb257-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb257-6"><a href="8-Movies.html#cb257-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">15000</span>)) <span class="sc">+</span></span>
<span id="cb257-7"><a href="8-Movies.html#cb257-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;投票数量&quot;</span>) <span class="sc">+</span></span>
<span id="cb257-8"><a href="8-Movies.html#cb257-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> vote_count), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb257-9"><a href="8-Movies.html#cb257-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> vote_average),</span>
<span id="cb257-10"><a href="8-Movies.html#cb257-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="dv">1000</span>,</span>
<span id="cb257-11"><a href="8-Movies.html#cb257-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;yellow&quot;</span>, <span class="at">size =</span> <span class="dv">3</span></span>
<span id="cb257-12"><a href="8-Movies.html#cb257-12" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="8-Movies_files/figure-html/unnamed-chunk-15-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>可以看到，投票多的电影，评分通常也不低。在投票最多的前20位电影中，最低分为6.5。</p>
</div>
<div id="评分" class="section level3 hasAnchor" number="8.2.2">
<h3><span class="header-section-number">8.2.2</span> 评分<a href="8-Movies.html#评分" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>评分最高的20部电影都有哪些？虽然已经耳熟能详，还是在图形上看看吧~</p>
<div class="rmdnote">
<p>有些极端的评分是由于投票数量过少导致的，就如同体育比赛中通常会去掉一个最高分和一个最低分，我们也需要做同样的处理以达到最真实的效果。
我们选择利用投票数对这部分内容进行筛选。</p>
</div>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="8-Movies.html#cb258-1" aria-hidden="true" tabindex="-1"></a>movies <span class="sc">%&gt;%</span></span>
<span id="cb258-2"><a href="8-Movies.html#cb258-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(vote_count <span class="sc">&gt;</span> <span class="dv">250</span>) <span class="sc">%&gt;%</span></span>
<span id="cb258-3"><a href="8-Movies.html#cb258-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="dv">20</span>, <span class="at">wt =</span> vote_average) <span class="sc">%&gt;%</span></span>
<span id="cb258-4"><a href="8-Movies.html#cb258-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(title, vote_average), <span class="at">y =</span> vote_average)) <span class="sc">+</span></span>
<span id="cb258-5"><a href="8-Movies.html#cb258-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb258-6"><a href="8-Movies.html#cb258-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb258-7"><a href="8-Movies.html#cb258-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb258-8"><a href="8-Movies.html#cb258-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;平均得分&quot;</span>) <span class="sc">+</span></span>
<span id="cb258-9"><a href="8-Movies.html#cb258-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> vote_average), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb258-10"><a href="8-Movies.html#cb258-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> vote_count),</span>
<span id="cb258-11"><a href="8-Movies.html#cb258-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fl">0.5</span>,</span>
<span id="cb258-12"><a href="8-Movies.html#cb258-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;yellow&quot;</span>, <span class="at">size =</span> <span class="dv">3</span></span>
<span id="cb258-13"><a href="8-Movies.html#cb258-13" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="8-Movies_files/figure-html/unnamed-chunk-16-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>我们熟悉的电影，肖申克的救赎、教父、爆裂鼓手等悉数上榜。</p>
<p>多数电影与我们年代都比较久远了，令人感叹。</p>
</div>
</div>
<div id="电影类型" class="section level2 hasAnchor" number="8.3">
<h2><span class="header-section-number">8.3</span> 电影类型<a href="8-Movies.html#电影类型" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="电影类型的数量" class="section level3 hasAnchor" number="8.3.1">
<h3><span class="header-section-number">8.3.1</span> 电影类型的数量<a href="8-Movies.html#电影类型的数量" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="8-Movies.html#cb259-1" aria-hidden="true" tabindex="-1"></a>genres <span class="sc">%&gt;%</span></span>
<span id="cb259-2"><a href="8-Movies.html#cb259-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(keyword) <span class="sc">%&gt;%</span></span>
<span id="cb259-3"><a href="8-Movies.html#cb259-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span></span>
<span id="cb259-4"><a href="8-Movies.html#cb259-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(keyword, n), <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb259-5"><a href="8-Movies.html#cb259-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb259-6"><a href="8-Movies.html#cb259-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">label =</span> n), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb259-7"><a href="8-Movies.html#cb259-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb259-8"><a href="8-Movies.html#cb259-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb259-9"><a href="8-Movies.html#cb259-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;电影数量&quot;</span>)</span></code></pre></div>
<p><img src="8-Movies_files/figure-html/unnamed-chunk-17-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="不同类型电影的评分" class="section level3 hasAnchor" number="8.3.2">
<h3><span class="header-section-number">8.3.2</span> 不同类型电影的评分<a href="8-Movies.html#不同类型电影的评分" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="8-Movies.html#cb260-1" aria-hidden="true" tabindex="-1"></a>genres250 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(genres,</span>
<span id="cb260-2"><a href="8-Movies.html#cb260-2" aria-hidden="true" tabindex="-1"></a>  movies <span class="sc">%&gt;%</span></span>
<span id="cb260-3"><a href="8-Movies.html#cb260-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(vote_count <span class="sc">&gt;</span> <span class="dv">250</span>) <span class="sc">%&gt;%</span></span>
<span id="cb260-4"><a href="8-Movies.html#cb260-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(</span>
<span id="cb260-5"><a href="8-Movies.html#cb260-5" aria-hidden="true" tabindex="-1"></a>      id, vote_average, vote_count,</span>
<span id="cb260-6"><a href="8-Movies.html#cb260-6" aria-hidden="true" tabindex="-1"></a>      original_language, original_title</span>
<span id="cb260-7"><a href="8-Movies.html#cb260-7" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb260-8"><a href="8-Movies.html#cb260-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">&quot;id&quot;</span></span>
<span id="cb260-9"><a href="8-Movies.html#cb260-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb260-10"><a href="8-Movies.html#cb260-10" aria-hidden="true" tabindex="-1"></a>genres250 <span class="ot">&lt;-</span> genres250 <span class="sc">%&gt;%</span></span>
<span id="cb260-11"><a href="8-Movies.html#cb260-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(genres250<span class="sc">$</span>vote_average))</span>
<span id="cb260-12"><a href="8-Movies.html#cb260-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-13"><a href="8-Movies.html#cb260-13" aria-hidden="true" tabindex="-1"></a>genres250<span class="sc">$</span>title <span class="ot">&lt;-</span> <span class="fu">str_trunc</span>(<span class="fu">as.character</span>(genres250<span class="sc">$</span>title),</span>
<span id="cb260-14"><a href="8-Movies.html#cb260-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">50</span>, <span class="at">side =</span> <span class="st">&quot;right&quot;</span></span>
<span id="cb260-15"><a href="8-Movies.html#cb260-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb260-16"><a href="8-Movies.html#cb260-16" aria-hidden="true" tabindex="-1"></a>genres250<span class="sc">$</span>title <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(genres250<span class="sc">$</span>title)</span>
<span id="cb260-17"><a href="8-Movies.html#cb260-17" aria-hidden="true" tabindex="-1"></a>genres250 <span class="sc">%&gt;%</span></span>
<span id="cb260-18"><a href="8-Movies.html#cb260-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>keyword <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Foreign&quot;</span>, <span class="st">&quot;TV Movie&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb260-19"><a href="8-Movies.html#cb260-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(keyword) <span class="sc">%&gt;%</span></span>
<span id="cb260-20"><a href="8-Movies.html#cb260-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(vote_average)) <span class="sc">%&gt;%</span></span>
<span id="cb260-21"><a href="8-Movies.html#cb260-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb260-22"><a href="8-Movies.html#cb260-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(title, vote_average), <span class="at">y =</span> vote_average)) <span class="sc">+</span></span>
<span id="cb260-23"><a href="8-Movies.html#cb260-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> keyword), <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb260-24"><a href="8-Movies.html#cb260-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="fl">8.5</span>)) <span class="sc">+</span></span>
<span id="cb260-25"><a href="8-Movies.html#cb260-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>keyword, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb260-26"><a href="8-Movies.html#cb260-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb260-27"><a href="8-Movies.html#cb260-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb260-28"><a href="8-Movies.html#cb260-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>))</span></code></pre></div>
<p><img src="8-Movies_files/figure-html/unnamed-chunk-18-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="最受欢迎的演员和导演" class="section level2 hasAnchor" number="8.4">
<h2><span class="header-section-number">8.4</span> 最受欢迎的演员和导演<a href="8-Movies.html#最受欢迎的演员和导演" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="section" class="section level3" number="8.4.1">
<h3><span class="header-section-number">8.4.1</span> </h3>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="8-Movies.html#cb261-1" aria-hidden="true" tabindex="-1"></a>cast1 <span class="sc">%&gt;%</span></span>
<span id="cb261-2"><a href="8-Movies.html#cb261-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="dv">20</span>, <span class="at">wt =</span> n) <span class="sc">%&gt;%</span></span>
<span id="cb261-3"><a href="8-Movies.html#cb261-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(actor, n), <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb261-4"><a href="8-Movies.html#cb261-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb261-5"><a href="8-Movies.html#cb261-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb261-6"><a href="8-Movies.html#cb261-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb261-7"><a href="8-Movies.html#cb261-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;主演电影数量&quot;</span>)</span></code></pre></div>
<p><img src="8-Movies_files/figure-html/unnamed-chunk-19-1.png" width="672" style="display: block; margin: auto;" /></p>
<ul>
<li><p>让我非常惊讶的是，“mother f**ker 侠”高居主演电影数量的第一位。</p></li>
<li><p>名单上的演员都是耳熟能详的了。</p></li>
</ul>
</div>
<div id="指导最多电影的导演" class="section level3 hasAnchor" number="8.4.2">
<h3><span class="header-section-number">8.4.2</span> 指导最多电影的导演<a href="8-Movies.html#指导最多电影的导演" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="8-Movies.html#cb262-1" aria-hidden="true" tabindex="-1"></a>movies <span class="sc">%&gt;%</span></span>
<span id="cb262-2"><a href="8-Movies.html#cb262-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(movies<span class="sc">$</span>director)) <span class="sc">%&gt;%</span></span>
<span id="cb262-3"><a href="8-Movies.html#cb262-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(director) <span class="sc">%&gt;%</span> <span class="co"># 等价于group_by(director) %&gt;% count()</span></span>
<span id="cb262-4"><a href="8-Movies.html#cb262-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="dv">20</span>, <span class="at">wt =</span> n) <span class="sc">%&gt;%</span></span>
<span id="cb262-5"><a href="8-Movies.html#cb262-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(director, n), <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb262-6"><a href="8-Movies.html#cb262-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb262-7"><a href="8-Movies.html#cb262-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">25</span>)) <span class="sc">+</span></span>
<span id="cb262-8"><a href="8-Movies.html#cb262-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb262-9"><a href="8-Movies.html#cb262-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;执导电影数量&quot;</span>)</span></code></pre></div>
<p><img src="8-Movies_files/figure-html/unnamed-chunk-20-1.png" width="672" style="display: block; margin: auto;" />
斯皮尔伯格指导电影的数量遥遥领先。</p>
</div>
</div>
<div id="keywords" class="section level2 hasAnchor" number="8.5">
<h2><span class="header-section-number">8.5</span> keywords<a href="8-Movies.html#keywords" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="使用最多的关键词" class="section level3 hasAnchor" number="8.5.1">
<h3><span class="header-section-number">8.5.1</span> 使用最多的关键词<a href="8-Movies.html#使用最多的关键词" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="8-Movies.html#cb263-1" aria-hidden="true" tabindex="-1"></a>keywords <span class="sc">%&gt;%</span></span>
<span id="cb263-2"><a href="8-Movies.html#cb263-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(keyword) <span class="sc">%&gt;%</span></span>
<span id="cb263-3"><a href="8-Movies.html#cb263-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="dv">20</span>, <span class="at">wt =</span> n) <span class="sc">%&gt;%</span></span>
<span id="cb263-4"><a href="8-Movies.html#cb263-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(keyword, n), <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb263-5"><a href="8-Movies.html#cb263-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb263-6"><a href="8-Movies.html#cb263-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb263-7"><a href="8-Movies.html#cb263-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;电影数量&quot;</span>)</span></code></pre></div>
<p><img src="8-Movies_files/figure-html/unnamed-chunk-21-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="8-Movies.html#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2019</span>)</span>
<span id="cb264-2"><a href="8-Movies.html#cb264-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-3"><a href="8-Movies.html#cb264-3" aria-hidden="true" tabindex="-1"></a>keywords_counts <span class="ot">&lt;-</span> keywords <span class="sc">%&gt;%</span> <span class="fu">count</span>(keyword)</span>
<span id="cb264-4"><a href="8-Movies.html#cb264-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-5"><a href="8-Movies.html#cb264-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="at">bg =</span> <span class="st">&quot;grey97&quot;</span>)</span>
<span id="cb264-6"><a href="8-Movies.html#cb264-6" aria-hidden="true" tabindex="-1"></a><span class="fu">wordcloud</span>(keywords_counts<span class="sc">$</span>keyword, keywords_counts<span class="sc">$</span>n,</span>
<span id="cb264-7"><a href="8-Movies.html#cb264-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">max.words =</span> <span class="dv">100</span>, <span class="at">scale =</span> <span class="fu">c</span>(<span class="fl">2.0</span>, .<span class="dv">5</span>),</span>
<span id="cb264-8"><a href="8-Movies.html#cb264-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">random.color =</span> <span class="cn">TRUE</span>, <span class="at">random.order =</span> <span class="cn">FALSE</span>,</span>
<span id="cb264-9"><a href="8-Movies.html#cb264-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">rot.per =</span> <span class="dv">0</span>, <span class="at">colors =</span> <span class="fu">brewer.pal</span>(<span class="dv">9</span>, <span class="st">&quot;Set1&quot;</span>)</span>
<span id="cb264-10"><a href="8-Movies.html#cb264-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="8-Movies_files/figure-html/unnamed-chunk-22-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="电影推荐" class="section level2 hasAnchor" number="8.6">
<h2><span class="header-section-number">8.6</span> 电影推荐<a href="8-Movies.html#电影推荐" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>使用IMDB的电影权重计算公式来对电影进行推荐。</p>
<p><span class="math display" id="eq:imdb">\[
\begin{align}
  W = \frac{R×v + C×m}{v + m}
  \tag{8.1}
\end{align}
\]</span>
式中：</p>
<ul>
<li><p>W为权重评级</p></li>
<li><p>R为电影的平均评分（vote_average）</p></li>
<li><p>v为总投票数（vote_count）</p></li>
<li><p>m为进入Top250电影所需的最低投票数</p></li>
<li><p>C为所有电影的评分的平均</p></li>
</ul>
<p>我们先对参数C和m进行计算，今儿计算W</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="8-Movies.html#cb265-1" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> <span class="fu">mean</span>(movies<span class="sc">$</span>vote_average)</span>
<span id="cb265-2"><a href="8-Movies.html#cb265-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">quantile</span>(movies<span class="sc">$</span>vote_count, <span class="fl">0.75</span>)</span>
<span id="cb265-3"><a href="8-Movies.html#cb265-3" aria-hidden="true" tabindex="-1"></a>movies<span class="sc">$</span>weighted_rating <span class="ot">&lt;-</span></span>
<span id="cb265-4"><a href="8-Movies.html#cb265-4" aria-hidden="true" tabindex="-1"></a>  (movies<span class="sc">$</span>vote_average <span class="sc">*</span> movies<span class="sc">$</span>vote_count <span class="sc">+</span> C <span class="sc">*</span> m) <span class="sc">/</span></span>
<span id="cb265-5"><a href="8-Movies.html#cb265-5" aria-hidden="true" tabindex="-1"></a>    (movies<span class="sc">$</span>vote_count <span class="sc">+</span> m)</span></code></pre></div>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="8-Movies.html#cb266-1" aria-hidden="true" tabindex="-1"></a>movies <span class="sc">%&gt;%</span></span>
<span id="cb266-2"><a href="8-Movies.html#cb266-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="dv">20</span>, <span class="at">wt =</span> weighted_rating) <span class="sc">%&gt;%</span></span>
<span id="cb266-3"><a href="8-Movies.html#cb266-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb266-4"><a href="8-Movies.html#cb266-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">reorder</span>(title, weighted_rating),</span>
<span id="cb266-5"><a href="8-Movies.html#cb266-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> weighted_rating</span>
<span id="cb266-6"><a href="8-Movies.html#cb266-6" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb266-7"><a href="8-Movies.html#cb266-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb266-8"><a href="8-Movies.html#cb266-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb266-9"><a href="8-Movies.html#cb266-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb266-10"><a href="8-Movies.html#cb266-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Weighted Rating&quot;</span>) <span class="sc">+</span></span>
<span id="cb266-11"><a href="8-Movies.html#cb266-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(weighted_rating, <span class="dv">2</span>)),</span>
<span id="cb266-12"><a href="8-Movies.html#cb266-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">3</span></span>
<span id="cb266-13"><a href="8-Movies.html#cb266-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb266-14"><a href="8-Movies.html#cb266-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb266-15"><a href="8-Movies.html#cb266-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste</span>(</span>
<span id="cb266-16"><a href="8-Movies.html#cb266-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Votes:&quot;</span>, vote_count,</span>
<span id="cb266-17"><a href="8-Movies.html#cb266-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Vote Average:&quot;</span>, vote_average</span>
<span id="cb266-18"><a href="8-Movies.html#cb266-18" aria-hidden="true" tabindex="-1"></a>  )),</span>
<span id="cb266-19"><a href="8-Movies.html#cb266-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fl">2.6</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;yellow&quot;</span></span>
<span id="cb266-20"><a href="8-Movies.html#cb266-20" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="8-Movies_files/figure-html/unnamed-chunk-24-1.png" width="672" style="display: block; margin: auto;" /></p>
<div id="基于类型和语言的简单推荐" class="section level3 hasAnchor" number="8.6.1">
<h3><span class="header-section-number">8.6.1</span> 基于类型和语言的简单推荐<a href="8-Movies.html#基于类型和语言的简单推荐" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="8-Movies.html#cb267-1" aria-hidden="true" tabindex="-1"></a>genres250 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(genres250,</span>
<span id="cb267-2"><a href="8-Movies.html#cb267-2" aria-hidden="true" tabindex="-1"></a>  movies <span class="sc">%&gt;%</span></span>
<span id="cb267-3"><a href="8-Movies.html#cb267-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(id, weighted_rating),</span>
<span id="cb267-4"><a href="8-Movies.html#cb267-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">&quot;id&quot;</span></span>
<span id="cb267-5"><a href="8-Movies.html#cb267-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb267-6"><a href="8-Movies.html#cb267-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-7"><a href="8-Movies.html#cb267-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 建立推荐函数</span></span>
<span id="cb267-8"><a href="8-Movies.html#cb267-8" aria-hidden="true" tabindex="-1"></a>recommendGenreLanguage <span class="ot">&lt;-</span> <span class="cf">function</span>(Genre, <span class="at">Language =</span> <span class="st">&quot;en&quot;</span>) {</span>
<span id="cb267-9"><a href="8-Movies.html#cb267-9" aria-hidden="true" tabindex="-1"></a>  genres250 <span class="sc">%&gt;%</span></span>
<span id="cb267-10"><a href="8-Movies.html#cb267-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(original_language <span class="sc">==</span> Language <span class="sc">&amp;</span> keyword <span class="sc">==</span> Genre) <span class="sc">%&gt;%</span></span>
<span id="cb267-11"><a href="8-Movies.html#cb267-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(weighted_rating)) <span class="sc">%&gt;%</span></span>
<span id="cb267-12"><a href="8-Movies.html#cb267-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb267-13"><a href="8-Movies.html#cb267-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(id, title, original_title, original_language, vote_count, vote_average, weighted_rating)</span>
<span id="cb267-14"><a href="8-Movies.html#cb267-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>我们看一下推荐的top5 Drama电影。</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="8-Movies.html#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="fu">recommendGenreLanguage</span>(<span class="st">&quot;Drama&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 7
##      id title original_title original_langua~ vote_count vote_average
##   &lt;dbl&gt; &lt;fct&gt; &lt;chr&gt;          &lt;chr&gt;                 &lt;dbl&gt;        &lt;dbl&gt;
## 1   278 The ~ The Shawshank~ en                     8205          8.5
## 2   238 The ~ The Godfather  en                     5893          8.4
## 3   550 Figh~ Fight Club     en                     9413          8.3
## 4   155 The ~ The Dark Knig~ en                    12002          8.2
## 5    13 Forr~ Forrest Gump   en                     7927          8.2
## # ... with 1 more variable: weighted_rating &lt;dbl&gt;</code></pre>
<p>我们在<code>recommendGernreLanguage()</code>函数中加入了language参数，意味着我们可以根据语言对推荐电影进行选择。</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="8-Movies.html#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="fu">recommendGenreLanguage</span>(<span class="st">&quot;Drama&quot;</span>, <span class="st">&quot;es&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 7
##      id title original_title original_langua~ vote_count vote_average
##   &lt;dbl&gt; &lt;fct&gt; &lt;chr&gt;          &lt;chr&gt;                 &lt;dbl&gt;        &lt;dbl&gt;
## 1  1417 Pan&#39;~ El laberinto ~ es                     3041          7.6
## 2 25376 The ~ El secreto de~ es                      626          7.8
## 3    55 Amor~ Amores perros  es                      521          7.6
## 4  6537 The ~ El orfanato    es                      633          7.1
## 5   219 Volv~ Volver         es                      406          7.3
## # ... with 1 more variable: weighted_rating &lt;dbl&gt;</code></pre>
</div>
<div id="基于电影内容的推荐演员导演类型" class="section level3 hasAnchor" number="8.6.2">
<h3><span class="header-section-number">8.6.2</span> 基于电影内容的推荐（演员、导演、类型）<a href="8-Movies.html#基于电影内容的推荐演员导演类型" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>编写了一个函数，为一部电影推荐5部类似的电影。根据以下几点对所有其他电影进行排序：</p>
<ol style="list-style-type: decimal">
<li><p>相似性的数量（相同的导演，相同的演员，相同的类型）。</p></li>
<li><p>当许多电影的相似性数量相同时，根据降序加权评级对它们进行排序。</p></li>
</ol>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="8-Movies.html#cb272-1" aria-hidden="true" tabindex="-1"></a>similarity_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb272-2"><a href="8-Movies.html#cb272-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;actor_1&quot;</span>, <span class="st">&quot;actor_2&quot;</span>, <span class="st">&quot;actor_3&quot;</span>,</span>
<span id="cb272-3"><a href="8-Movies.html#cb272-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;director&quot;</span>,</span>
<span id="cb272-4"><a href="8-Movies.html#cb272-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;genre_1&quot;</span>, <span class="st">&quot;genre_2&quot;</span>, <span class="st">&quot;genre_3&quot;</span></span>
<span id="cb272-5"><a href="8-Movies.html#cb272-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb272-6"><a href="8-Movies.html#cb272-6" aria-hidden="true" tabindex="-1"></a>movies_filter <span class="ot">&lt;-</span> movies <span class="sc">%&gt;%</span></span>
<span id="cb272-7"><a href="8-Movies.html#cb272-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, title, <span class="sc">!!</span>similarity_vars) <span class="sc">%&gt;%</span></span>
<span id="cb272-8"><a href="8-Movies.html#cb272-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.factor, as.character)</span>
<span id="cb272-9"><a href="8-Movies.html#cb272-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-10"><a href="8-Movies.html#cb272-10" aria-hidden="true" tabindex="-1"></a>recommend_similar <span class="ot">&lt;-</span> <span class="cf">function</span>(movie) {</span>
<span id="cb272-11"><a href="8-Movies.html#cb272-11" aria-hidden="true" tabindex="-1"></a>  director <span class="ot">&lt;-</span> movies_filter<span class="sc">$</span>director[movies_filter<span class="sc">$</span>id <span class="sc">==</span> movie]</span>
<span id="cb272-12"><a href="8-Movies.html#cb272-12" aria-hidden="true" tabindex="-1"></a>  actor1 <span class="ot">&lt;-</span> movies_filter<span class="sc">$</span>actor_1[movies_filter<span class="sc">$</span>id <span class="sc">==</span> movie]</span>
<span id="cb272-13"><a href="8-Movies.html#cb272-13" aria-hidden="true" tabindex="-1"></a>  actor2 <span class="ot">&lt;-</span> movies_filter<span class="sc">$</span>actor_2[movies_filter<span class="sc">$</span>id <span class="sc">==</span> movie]</span>
<span id="cb272-14"><a href="8-Movies.html#cb272-14" aria-hidden="true" tabindex="-1"></a>  actor3 <span class="ot">&lt;-</span> movies_filter<span class="sc">$</span>actor_3[movies_filter<span class="sc">$</span>id <span class="sc">==</span> movie]</span>
<span id="cb272-15"><a href="8-Movies.html#cb272-15" aria-hidden="true" tabindex="-1"></a>  genre1 <span class="ot">&lt;-</span> movies_filter<span class="sc">$</span>genre_1[movies_filter<span class="sc">$</span>id <span class="sc">==</span> movie]</span>
<span id="cb272-16"><a href="8-Movies.html#cb272-16" aria-hidden="true" tabindex="-1"></a>  genre2 <span class="ot">&lt;-</span> movies_filter<span class="sc">$</span>genre_2[movies_filter<span class="sc">$</span>id <span class="sc">==</span> movie]</span>
<span id="cb272-17"><a href="8-Movies.html#cb272-17" aria-hidden="true" tabindex="-1"></a>  genre3 <span class="ot">&lt;-</span> movies_filter<span class="sc">$</span>genre_3[movies_filter<span class="sc">$</span>id <span class="sc">==</span> movie]</span>
<span id="cb272-18"><a href="8-Movies.html#cb272-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-19"><a href="8-Movies.html#cb272-19" aria-hidden="true" tabindex="-1"></a>  rec_df <span class="ot">&lt;-</span> movies_filter</span>
<span id="cb272-20"><a href="8-Movies.html#cb272-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-21"><a href="8-Movies.html#cb272-21" aria-hidden="true" tabindex="-1"></a>  rec_df<span class="sc">$</span>same_director <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb272-22"><a href="8-Movies.html#cb272-22" aria-hidden="true" tabindex="-1"></a>  rec_df<span class="sc">$</span>same_a1 <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb272-23"><a href="8-Movies.html#cb272-23" aria-hidden="true" tabindex="-1"></a>  rec_df<span class="sc">$</span>same_a2 <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb272-24"><a href="8-Movies.html#cb272-24" aria-hidden="true" tabindex="-1"></a>  rec_df<span class="sc">$</span>same_a3 <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb272-25"><a href="8-Movies.html#cb272-25" aria-hidden="true" tabindex="-1"></a>  rec_df<span class="sc">$</span>same_g1 <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb272-26"><a href="8-Movies.html#cb272-26" aria-hidden="true" tabindex="-1"></a>  rec_df<span class="sc">$</span>same_g2 <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb272-27"><a href="8-Movies.html#cb272-27" aria-hidden="true" tabindex="-1"></a>  rec_df<span class="sc">$</span>same_g3 <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb272-28"><a href="8-Movies.html#cb272-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-29"><a href="8-Movies.html#cb272-29" aria-hidden="true" tabindex="-1"></a>  rec_df<span class="sc">$</span>same_director <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(rec_df<span class="sc">$</span>director <span class="sc">==</span> director, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb272-30"><a href="8-Movies.html#cb272-30" aria-hidden="true" tabindex="-1"></a>  rec_df<span class="sc">$</span>same_a1 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(rec_df<span class="sc">$</span>actor_1 <span class="sc">==</span> actor1 <span class="sc">|</span> rec_df<span class="sc">$</span>actor_2 <span class="sc">==</span> actor1 <span class="sc">|</span> rec_df<span class="sc">$</span>actor_3 <span class="sc">==</span> actor1, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb272-31"><a href="8-Movies.html#cb272-31" aria-hidden="true" tabindex="-1"></a>  rec_df<span class="sc">$</span>same_a2 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(rec_df<span class="sc">$</span>actor_1 <span class="sc">==</span> actor2 <span class="sc">|</span> rec_df<span class="sc">$</span>actor_2 <span class="sc">==</span> actor2 <span class="sc">|</span> rec_df<span class="sc">$</span>actor_3 <span class="sc">==</span> actor2, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb272-32"><a href="8-Movies.html#cb272-32" aria-hidden="true" tabindex="-1"></a>  rec_df<span class="sc">$</span>same_a3 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(rec_df<span class="sc">$</span>actor_1 <span class="sc">==</span> actor3 <span class="sc">|</span> rec_df<span class="sc">$</span>actor_2 <span class="sc">==</span> actor3 <span class="sc">|</span> rec_df<span class="sc">$</span>actor_3 <span class="sc">==</span> actor3, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb272-33"><a href="8-Movies.html#cb272-33" aria-hidden="true" tabindex="-1"></a>  rec_df<span class="sc">$</span>same_g1 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(rec_df<span class="sc">$</span>genre_1 <span class="sc">==</span> genre1 <span class="sc">|</span> rec_df<span class="sc">$</span>genre_2 <span class="sc">==</span> genre1 <span class="sc">|</span> rec_df<span class="sc">$</span>genre_3 <span class="sc">==</span> genre1, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb272-34"><a href="8-Movies.html#cb272-34" aria-hidden="true" tabindex="-1"></a>  rec_df<span class="sc">$</span>same_g2 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(rec_df<span class="sc">$</span>genre_1 <span class="sc">==</span> genre2 <span class="sc">|</span> rec_df<span class="sc">$</span>genre_2 <span class="sc">==</span> genre2 <span class="sc">|</span> rec_df<span class="sc">$</span>genre_3 <span class="sc">==</span> genre2, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb272-35"><a href="8-Movies.html#cb272-35" aria-hidden="true" tabindex="-1"></a>  rec_df<span class="sc">$</span>same_g3 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(rec_df<span class="sc">$</span>genre_1 <span class="sc">==</span> genre3 <span class="sc">|</span> rec_df<span class="sc">$</span>genre_2 <span class="sc">==</span> genre3 <span class="sc">|</span> rec_df<span class="sc">$</span>genre_3 <span class="sc">==</span> genre3, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb272-36"><a href="8-Movies.html#cb272-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-37"><a href="8-Movies.html#cb272-37" aria-hidden="true" tabindex="-1"></a>  rec_df <span class="ot">&lt;-</span> rec_df <span class="sc">%&gt;%</span> <span class="fu">mutate_at</span>(<span class="fu">vars</span>(<span class="st">&quot;same_director&quot;</span><span class="sc">:</span><span class="st">&quot;same_g3&quot;</span>), <span class="fu">list</span>(<span class="sc">~</span> <span class="fu">replace</span>(., <span class="fu">is.na</span>(.), <span class="dv">0</span>)))</span>
<span id="cb272-38"><a href="8-Movies.html#cb272-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-39"><a href="8-Movies.html#cb272-39" aria-hidden="true" tabindex="-1"></a>  rec_df<span class="sc">$</span>sim_count <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(rec_df[, <span class="dv">10</span><span class="sc">:</span><span class="dv">16</span>])</span>
<span id="cb272-40"><a href="8-Movies.html#cb272-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-41"><a href="8-Movies.html#cb272-41" aria-hidden="true" tabindex="-1"></a>  rec_df <span class="ot">&lt;-</span> <span class="fu">left_join</span>(rec_df, movies <span class="sc">%&gt;%</span> <span class="fu">select</span>(id, weighted_rating), <span class="at">by =</span> <span class="st">&quot;id&quot;</span>)</span>
<span id="cb272-42"><a href="8-Movies.html#cb272-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-43"><a href="8-Movies.html#cb272-43" aria-hidden="true" tabindex="-1"></a>  Top5_rec <span class="ot">&lt;-</span> rec_df <span class="sc">%&gt;%</span></span>
<span id="cb272-44"><a href="8-Movies.html#cb272-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(sim_count), <span class="fu">desc</span>(weighted_rating)) <span class="sc">%&gt;%</span></span>
<span id="cb272-45"><a href="8-Movies.html#cb272-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb272-46"><a href="8-Movies.html#cb272-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(id, title, sim_count, weighted_rating, <span class="fu">everything</span>())</span>
<span id="cb272-47"><a href="8-Movies.html#cb272-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-48"><a href="8-Movies.html#cb272-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(Top5_rec) <span class="sc">%&gt;%</span></span>
<span id="cb272-49"><a href="8-Movies.html#cb272-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">TRUE</span>)</span>
<span id="cb272-50"><a href="8-Movies.html#cb272-50" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb272-51"><a href="8-Movies.html#cb272-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-52"><a href="8-Movies.html#cb272-52" aria-hidden="true" tabindex="-1"></a><span class="fu">recommend_similar</span>(<span class="dv">597</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
title
</th>
<th style="text-align:right;">
sim_count
</th>
<th style="text-align:right;">
weighted_rating
</th>
<th style="text-align:left;">
actor_1
</th>
<th style="text-align:left;">
actor_2
</th>
<th style="text-align:left;">
actor_3
</th>
<th style="text-align:left;">
director
</th>
<th style="text-align:left;">
genre_1
</th>
<th style="text-align:left;">
genre_2
</th>
<th style="text-align:left;">
genre_3
</th>
<th style="text-align:right;">
same_director
</th>
<th style="text-align:right;">
same_a1
</th>
<th style="text-align:right;">
same_a2
</th>
<th style="text-align:right;">
same_a3
</th>
<th style="text-align:right;">
same_g1
</th>
<th style="text-align:right;">
same_g2
</th>
<th style="text-align:right;">
same_g3
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
597
</td>
<td style="text-align:left;">
Titanic
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
7.374977
</td>
<td style="text-align:left;">
Kate Winslet
</td>
<td style="text-align:left;">
Leonardo DiCaprio
</td>
<td style="text-align:left;">
Frances Fisher
</td>
<td style="text-align:left;">
James Cameron
</td>
<td style="text-align:left;">
Drama
</td>
<td style="text-align:left;">
Romance
</td>
<td style="text-align:left;">
Thriller
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
4148
</td>
<td style="text-align:left;">
Revolutionary Road
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
6.407782
</td>
<td style="text-align:left;">
Leonardo DiCaprio
</td>
<td style="text-align:left;">
Kate Winslet
</td>
<td style="text-align:left;">
Michael Shannon
</td>
<td style="text-align:left;">
Sam Mendes
</td>
<td style="text-align:left;">
Drama
</td>
<td style="text-align:left;">
Romance
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
1422
</td>
<td style="text-align:left;">
The Departed
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
7.637516
</td>
<td style="text-align:left;">
Leonardo DiCaprio
</td>
<td style="text-align:left;">
Matt Damon
</td>
<td style="text-align:left;">
Jack Nicholson
</td>
<td style="text-align:left;">
Martin Scorsese
</td>
<td style="text-align:left;">
Drama
</td>
<td style="text-align:left;">
Thriller
</td>
<td style="text-align:left;">
Crime
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
11324
</td>
<td style="text-align:left;">
Shutter Island
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
7.622046
</td>
<td style="text-align:left;">
Leonardo DiCaprio
</td>
<td style="text-align:left;">
Mark Ruffalo
</td>
<td style="text-align:left;">
Ben Kingsley
</td>
<td style="text-align:left;">
Martin Scorsese
</td>
<td style="text-align:left;">
Drama
</td>
<td style="text-align:left;">
Thriller
</td>
<td style="text-align:left;">
Mystery
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
38
</td>
<td style="text-align:left;">
Eternal Sunshine of the Spotless Mind
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
7.596430
</td>
<td style="text-align:left;">
Jim Carrey
</td>
<td style="text-align:left;">
Kate Winslet
</td>
<td style="text-align:left;">
Kirsten Dunst
</td>
<td style="text-align:left;">
Michel Gondry
</td>
<td style="text-align:left;">
Science Fiction
</td>
<td style="text-align:left;">
Drama
</td>
<td style="text-align:left;">
Romance
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
64682
</td>
<td style="text-align:left;">
The Great Gatsby
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
7.102448
</td>
<td style="text-align:left;">
Leonardo DiCaprio
</td>
<td style="text-align:left;">
Tobey Maguire
</td>
<td style="text-align:left;">
Carey Mulligan
</td>
<td style="text-align:left;">
Baz Luhrmann
</td>
<td style="text-align:left;">
Drama
</td>
<td style="text-align:left;">
Romance
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="7-mushrooms.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="23-appendix.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/XiangyunHuang/masr/edit/master/8-Movies.rmd",
"text": "编辑"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/XiangyunHuang/masr/blob/master/8-Movies.rmd",
"text": "查看"
},
"download": ["elegantbookdown.pdf", "elegantbookdown.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
